<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<!-- <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css"> -->
<link rel="shortcut icon" href="/assets/favicon.ico">
<title>zabbix监控mongo</title>
<!-- Begin Jekyll SEO tag v2.1.0 -->
<title>zabbix监控mongo - 求索</title>
<meta property="og:title" content="zabbix监控mongo" />
<meta name="description" content="可配合zabbix自动发现，自动监控服务 script cat mongo.sh #!/bin/bash case $1 in # use_memory) # used_memory=`echo &quot;db.serverStatus().mem&quot;|mongo admin|grep resident|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &quot; ,&quot;` # echo $used_memory # ;; # # use_vmemory) # used_vmemory=`echo &quot;db.serverStatus().mem&quot;|mongo admin|grep virtual|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &quot; ,&quot;` # echo $used_vmemory # ;; # # used_conn) # used_conn=`echo &quot;db.serverStatus().connections&quot;|mongo admin|grep current|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &#39; ,&#39;` # echo $used_conn # ;; # # available_conn) # available=`echo &quot;db.serverStatus().connections&quot;|mongo admin|grep available|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &#39; ,&#39;` # echo $availabe # ;; insert) insert=`mongostat -n1 | tail -n 1|awk &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $insert ;; query) query=`mongostat -n1 | tail -n 1|awk &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $query ;; update) update=`mongostat -n1 | tail -n 1|awk &#39;{print $3}&#39;|tr -d &#39; *,&#39;` echo $update ;; delete) delete=`mongostat -n1 | tail -n 1|awk &#39;{print $4}&#39;|tr -d &#39; *,&#39;` echo $delete ;; getmore) getmore=`mongostat -n1 | tail -n 1|awk &#39;{print $5}&#39;|tr -d &#39; *,&#39;` echo $getmore ;; command) command=`mongostat -n1 | tail -n 1|awk &#39;{print $6}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $command ;; vsize) vsize=`mongostat -n1 | tail -n 1|awk &#39;{print $10}&#39;|tr -d &#39; *,G&#39;` echo $vsize ;; res) res=`mongostat -n1 | tail -n 1|awk &#39;{print $11}&#39;|tr -d &#39; *,G&#39;` echo $res ;; qr) qr=`mongostat -n1 | tail -n 1|awk &#39;{print $12}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $qr ;; qw) qw=`mongostat -n1 | tail -n 1|awk &#39;{print $12}&#39;|awk -F&#39;|&#39; &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $qw ;; ar) ar=`mongostat -n1 | tail -n 1|awk &#39;{print $13}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $ar ;; aw) aw=`mongostat -n1 | tail -n 1|awk &#39;{print $13}&#39;|awk -F&#39;|&#39; &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $aw ;; conn) conn=`mongostat -n1 | tail -n 1|awk &#39;{print $16}&#39;|tr -d &#39; *,&#39;` echo $conn ;; *) echo &quot;please input insert|query|update|delete&quot; ;; esac conf配置文件 cat zabbix_mongo.conf UserParameter=mongo[*],/opt/script/zabbix/mongo.sh $1" />
<meta property="og:description" content="可配合zabbix自动发现，自动监控服务 script cat mongo.sh #!/bin/bash case $1 in # use_memory) # used_memory=`echo &quot;db.serverStatus().mem&quot;|mongo admin|grep resident|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &quot; ,&quot;` # echo $used_memory # ;; # # use_vmemory) # used_vmemory=`echo &quot;db.serverStatus().mem&quot;|mongo admin|grep virtual|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &quot; ,&quot;` # echo $used_vmemory # ;; # # used_conn) # used_conn=`echo &quot;db.serverStatus().connections&quot;|mongo admin|grep current|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &#39; ,&#39;` # echo $used_conn # ;; # # available_conn) # available=`echo &quot;db.serverStatus().connections&quot;|mongo admin|grep available|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &#39; ,&#39;` # echo $availabe # ;; insert) insert=`mongostat -n1 | tail -n 1|awk &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $insert ;; query) query=`mongostat -n1 | tail -n 1|awk &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $query ;; update) update=`mongostat -n1 | tail -n 1|awk &#39;{print $3}&#39;|tr -d &#39; *,&#39;` echo $update ;; delete) delete=`mongostat -n1 | tail -n 1|awk &#39;{print $4}&#39;|tr -d &#39; *,&#39;` echo $delete ;; getmore) getmore=`mongostat -n1 | tail -n 1|awk &#39;{print $5}&#39;|tr -d &#39; *,&#39;` echo $getmore ;; command) command=`mongostat -n1 | tail -n 1|awk &#39;{print $6}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $command ;; vsize) vsize=`mongostat -n1 | tail -n 1|awk &#39;{print $10}&#39;|tr -d &#39; *,G&#39;` echo $vsize ;; res) res=`mongostat -n1 | tail -n 1|awk &#39;{print $11}&#39;|tr -d &#39; *,G&#39;` echo $res ;; qr) qr=`mongostat -n1 | tail -n 1|awk &#39;{print $12}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $qr ;; qw) qw=`mongostat -n1 | tail -n 1|awk &#39;{print $12}&#39;|awk -F&#39;|&#39; &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $qw ;; ar) ar=`mongostat -n1 | tail -n 1|awk &#39;{print $13}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $ar ;; aw) aw=`mongostat -n1 | tail -n 1|awk &#39;{print $13}&#39;|awk -F&#39;|&#39; &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $aw ;; conn) conn=`mongostat -n1 | tail -n 1|awk &#39;{print $16}&#39;|tr -d &#39; *,&#39;` echo $conn ;; *) echo &quot;please input insert|query|update|delete&quot; ;; esac conf配置文件 cat zabbix_mongo.conf UserParameter=mongo[*],/opt/script/zabbix/mongo.sh $1" />
<link rel="canonical" href="http://localhost:4000/2016/12/19/zabbix-monitor-mongo" />
<meta property="og:url" content="http://localhost:4000/2016/12/19/zabbix-monitor-mongo" />
<meta property="og:site_name" content="求索" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-12-19T13:12:27+08:00" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "zabbix监控mongo",
"datePublished": "2016-12-19T13:12:27+08:00",
"description": "可配合zabbix自动发现，自动监控服务 script cat mongo.sh #!/bin/bash case $1 in # use_memory) # used_memory=`echo &quot;db.serverStatus().mem&quot;|mongo admin|grep resident|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &quot; ,&quot;` # echo $used_memory # ;; # # use_vmemory) # used_vmemory=`echo &quot;db.serverStatus().mem&quot;|mongo admin|grep virtual|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &quot; ,&quot;` # echo $used_vmemory # ;; # # used_conn) # used_conn=`echo &quot;db.serverStatus().connections&quot;|mongo admin|grep current|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &#39; ,&#39;` # echo $used_conn # ;; # # available_conn) # available=`echo &quot;db.serverStatus().connections&quot;|mongo admin|grep available|awk -F&#39;:&#39; &#39;{print $2}&#39;|tr -d &#39; ,&#39;` # echo $availabe # ;; insert) insert=`mongostat -n1 | tail -n 1|awk &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $insert ;; query) query=`mongostat -n1 | tail -n 1|awk &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $query ;; update) update=`mongostat -n1 | tail -n 1|awk &#39;{print $3}&#39;|tr -d &#39; *,&#39;` echo $update ;; delete) delete=`mongostat -n1 | tail -n 1|awk &#39;{print $4}&#39;|tr -d &#39; *,&#39;` echo $delete ;; getmore) getmore=`mongostat -n1 | tail -n 1|awk &#39;{print $5}&#39;|tr -d &#39; *,&#39;` echo $getmore ;; command) command=`mongostat -n1 | tail -n 1|awk &#39;{print $6}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $command ;; vsize) vsize=`mongostat -n1 | tail -n 1|awk &#39;{print $10}&#39;|tr -d &#39; *,G&#39;` echo $vsize ;; res) res=`mongostat -n1 | tail -n 1|awk &#39;{print $11}&#39;|tr -d &#39; *,G&#39;` echo $res ;; qr) qr=`mongostat -n1 | tail -n 1|awk &#39;{print $12}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $qr ;; qw) qw=`mongostat -n1 | tail -n 1|awk &#39;{print $12}&#39;|awk -F&#39;|&#39; &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $qw ;; ar) ar=`mongostat -n1 | tail -n 1|awk &#39;{print $13}&#39;|awk -F&#39;|&#39; &#39;{print $1}&#39;|tr -d &#39; *,&#39;` echo $ar ;; aw) aw=`mongostat -n1 | tail -n 1|awk &#39;{print $13}&#39;|awk -F&#39;|&#39; &#39;{print $2}&#39;|tr -d &#39; *,&#39;` echo $aw ;; conn) conn=`mongostat -n1 | tail -n 1|awk &#39;{print $16}&#39;|tr -d &#39; *,&#39;` echo $conn ;; *) echo &quot;please input insert|query|update|delete&quot; ;; esac conf配置文件 cat zabbix_mongo.conf UserParameter=mongo[*],/opt/script/zabbix/mongo.sh $1",
"url": "http://localhost:4000/2016/12/19/zabbix-monitor-mongo"}</script>
<!-- End Jekyll SEO tag -->
</head>

<body>
	<main class="container">
		<section class="about">
			<a href="/"><img src="/assets/profile.png" alt="Mingxu.Xie"></a>
			<h2>Mingxu.Xie</h2>
			<p class="tagline">Devops</p>
			<ul class="social">
				<a href="https://github.com/xiemx">
					<li><i class="icon-github-circled"></i></li>
				</a>
				<a href="https://www.linkedin.com/in/xiemx1991">
					<li><i class="icon-linkedin-squared"></i></li>
				</a>
				<a href="https://twitter.com/xiemx1991">
					<li><i class="icon-twitter-squared"></i></li>
				</a>
			</ul>
			<p>&copy; 尔不必求记，却宜求个明白！</p>
			<div>
				<div class="categories">
					<h4>Categories</h4>
					<ul>
						<a href="/">
							<li>Index</li>
						</a>
						<a href="/pages/about.html">
							<li>About</li>
						</a>
						<a href="/pages/archive.html">
							<li>Archive</li>
						</a>
						<a href="/blog/">
							<li>Blogs</li>
						</a>
						<a href="/pages/commands.html">
							<li>Commands</li>
						</a>
					</ul>
				</div>
				<div class="tags" style="width:200px;white-space:normal">
					<h4>Tag Cloud:</h4>
					<a href="/tag/cluster/" class="set-1">cluster</a> <a href="/tag/command/" class="set-1">command</a> <a href="/tag/deployment/" class="set-1">deployment</a> <a href="/tag/domain/" class="set-1">domain</a> <a href="/tag/http/" class="set-1">http</a> <a href="/tag/iis/" class="set-1">iis</a> <a href="/tag/issue/" class="set-1">issue</a> <a href="/tag/memcache/" class="set-1">memcache</a> <a href="/tag/mime-type/" class="set-1">mime-type</a> <a href="/tag/mongo/" class="set-1">mongo</a> <a href="/tag/monitor/" class="set-1">monitor</a> <a href="/tag/mysql/" class="set-1">mysql</a> <a href="/tag/python/" class="set-1">python</a> <a href="/tag/scripts/" class="set-1">scripts</a> <a href="/tag/shell/" class="set-1">shell</a> <a href="/tag/statuscode/" class="set-1">statusCode</a> <a href="/tag/uwsgi/" class="set-1">uwsgi</a> <a href="/tag/vagrant/" class="set-1">vagrant</a> <a href="/tag/vcenter/" class="set-1">vcenter</a> <a href="/tag/windows/" class="set-2">windows</a> <a href="/tag/zabbix/" class="set-5">zabbix</a> <a href="/tag/zentaopms/" class="set-1">zentaopms</a>
				</div>
			</div>
		</section>
		<section class="content">
			<div class="post-container">
  <a class="post-link" href="/2016/12/19/zabbix-monitor-mongo">
    <h2 class="post-title">zabbix监控mongo</h2>
  </a>
  <div class="post-meta">
    <ul class="post-categories"><li>zabbix</li></ul>
    <div class="post-date"><i class="icon-calendar"></i>Dec 19, 2016</div>
  </div>
  <div class="post">
    <p>可配合zabbix自动发现，自动监控服务</p>
<h3 id="script">script</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>mongo.sh

<span class="c">#!/bin/bash</span>

<span class="k">case</span> <span class="nv">$1</span> <span class="k">in</span> 
<span class="c">#  use_memory)</span>
<span class="c">#    used_memory=`echo "db.serverStatus().mem"|mongo admin|grep resident|awk -F':' '{print $2}'|tr -d " ,"`</span>
<span class="c">#    echo $used_memory</span>
<span class="c">#    ;;</span>
<span class="c">#  </span>
<span class="c">#  use_vmemory)</span>
<span class="c">#    used_vmemory=`echo "db.serverStatus().mem"|mongo admin|grep virtual|awk -F':' '{print $2}'|tr -d " ,"`</span>
<span class="c">#    echo $used_vmemory</span>
<span class="c">#    ;;</span>
<span class="c">#  </span>
<span class="c">#  used_conn)</span>
<span class="c">#    used_conn=`echo "db.serverStatus().connections"|mongo admin|grep current|awk -F':' '{print $2}'|tr -d ' ,'`</span>
<span class="c">#    echo $used_conn</span>
<span class="c">#    ;;</span>
<span class="c">#  </span>
<span class="c">#  available_conn)</span>
<span class="c">#    available=`echo "db.serverStatus().connections"|mongo admin|grep available|awk -F':' '{print $2}'|tr -d ' ,'`</span>
<span class="c">#    echo $availabe</span>
<span class="c">#  ;;</span>
  
  insert<span class="p">)</span>
    <span class="nv">insert</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $1}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$insert</span>
    <span class="p">;;</span>
  
  query<span class="p">)</span>
    <span class="nv">query</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $2}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$query</span>
    <span class="p">;;</span>
  
  update<span class="p">)</span>
    <span class="nv">update</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $3}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$update</span>
    <span class="p">;;</span>
  
  delete<span class="p">)</span>
    <span class="nv">delete</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $4}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$delete</span>
    <span class="p">;;</span>
  getmore<span class="p">)</span>
    <span class="nv">getmore</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $5}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>  
    <span class="nb">echo</span> <span class="nv">$getmore</span>
    <span class="p">;;</span>
  <span class="nb">command</span><span class="p">)</span>
    <span class="nb">command</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $6}'</span>|awk <span class="nt">-F</span><span class="s1">'|'</span> <span class="s1">'{print $1}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$command</span>
    <span class="p">;;</span>
  vsize<span class="p">)</span>
    <span class="nv">vsize</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $10}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,G'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$vsize</span>
    <span class="p">;;</span>
  res<span class="p">)</span>
    <span class="nv">res</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $11}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,G'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$res</span>
    <span class="p">;;</span>
  qr<span class="p">)</span>
    <span class="nv">qr</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $12}'</span>|awk <span class="nt">-F</span><span class="s1">'|'</span> <span class="s1">'{print $1}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$qr</span>
    <span class="p">;;</span>
  qw<span class="p">)</span>
    <span class="nv">qw</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $12}'</span>|awk <span class="nt">-F</span><span class="s1">'|'</span> <span class="s1">'{print $2}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$qw</span>
    <span class="p">;;</span>
  ar<span class="p">)</span>
    <span class="nv">ar</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $13}'</span>|awk <span class="nt">-F</span><span class="s1">'|'</span> <span class="s1">'{print $1}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$ar</span>
    <span class="p">;;</span>
  aw<span class="p">)</span>
    <span class="nv">aw</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $13}'</span>|awk <span class="nt">-F</span><span class="s1">'|'</span> <span class="s1">'{print $2}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$aw</span>
    <span class="p">;;</span>
  conn<span class="p">)</span>
    <span class="nv">conn</span><span class="o">=</span><span class="sb">`</span>mongostat <span class="nt">-n1</span> | <span class="nb">tail</span> <span class="nt">-n</span> 1|awk <span class="s1">'{print $16}'</span>|tr <span class="nt">-d</span> <span class="s1">' *,'</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$conn</span>
    <span class="p">;;</span>

  <span class="k">*</span><span class="p">)</span>
    <span class="nb">echo</span> <span class="s2">"please input  insert|query|update|delete"</span>
    <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h3 id="conf配置文件">conf配置文件</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>zabbix_mongo.conf
<span class="nv">UserParameter</span><span class="o">=</span>mongo[<span class="k">*</span><span class="o">]</span>,/opt/script/zabbix/mongo.sh <span class="nv">$1</span>
</code></pre></div></div>

  </div>
		</section>
	</main></body>

</html>