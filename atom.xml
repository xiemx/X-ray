<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>求索</title>
  
  <subtitle>尔不必求记，却宜求个明白！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.xiemx.com/"/>
  <updated>2023-06-09T07:36:51.539Z</updated>
  <id>https://www.xiemx.com/</id>
  
  <author>
    <name>mingxu.xie</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>synchronized锁</title>
    <link href="https://www.xiemx.com//2023/06/08/synchronized%E9%94%81/"/>
    <id>https://www.xiemx.com//2023/06/08/synchronized锁/</id>
    <published>2023-06-08T07:54:11.000Z</published>
    <updated>2023-06-09T07:36:51.539Z</updated>
    
    <content type="html"><![CDATA[<h2 id="synchronized-锁"><a class="markdownIt-Anchor" href="#synchronized-锁"></a> synchronized 锁</h2><ol><li>修饰代码块</li><li>修饰方法</li></ol><h3 id="使用"><a class="markdownIt-Anchor" href="#使用"></a> 使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例方法, 对象级别锁</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">lock1</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 静态方法，类全局锁</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">lock2</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lock3</span><span class="params">()</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 同类锁</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.getClass()) &#123;</span><br><span class="line">        <span class="comment">// do</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 同对象锁</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>)&#123;</span><br><span class="line">        <span class="comment">// do</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="原理"><a class="markdownIt-Anchor" href="#原理"></a> 原理</h3><ol><li>修饰代码块的时候使用的是通过 <code>monitorenter</code> 和 <code>monitorexit</code> 来获取monitor Object对象进行加、解锁</li><li>修饰方法时通过方法的 <code>ACC_SYNCHRONIZED</code> 标志位来进行锁定</li></ol><h3 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h3><p><a href="https://zhuanlan.zhihu.com/p/350356657">https://zhuanlan.zhihu.com/p/350356657</a><br /><a href="https://segmentfault.com/a/1190000041259193">https://segmentfault.com/a/1190000041259193</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;synchronized-锁&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#synchronized-锁&quot;&gt;&lt;/a&gt; synchronized 锁&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;修饰代码块&lt;/li&gt;
&lt;li&gt;修饰方法&lt;/li&gt;
&lt;/ol&gt;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>单例模式</title>
    <link href="https://www.xiemx.com//2023/06/08/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>https://www.xiemx.com//2023/06/08/单例模式/</id>
    <published>2023-06-08T06:34:20.000Z</published>
    <updated>2023-06-09T07:36:51.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="单例模式"><a class="markdownIt-Anchor" href="#单例模式"></a> 单例模式</h2><blockquote><p>一个类只能有一个实例，并提供一个全局访问点</p><ol><li>私有的构造方法</li><li>私有的静态变量存储实例对象</li><li>提供一个静态方法供外部获取实例对象</li></ol><footer><strong>单例模式 singleton pattern</strong></footer></blockquote><h3 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意</h3><ol><li>单例创建要保证线程安全</li><li>是否需要延迟创建</li></ol><h3 id="实现"><a class="markdownIt-Anchor" href="#实现"></a> 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 类加载阶段完成创建</span></span><br><span class="line"><span class="comment">// 1. 线程安全</span></span><br><span class="line"><span class="comment">// 2. 实时创建</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取对象时创建</span></span><br><span class="line"><span class="comment">// 1. 延迟创建</span></span><br><span class="line"><span class="comment">// 2. 加锁保障线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加锁保障线程安全，可以优化一下只对创建时加锁</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span>  Singleton <span class="title function_">getInstace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取对象时加锁</span></span><br><span class="line"><span class="comment">// 1. 延迟创建</span></span><br><span class="line"><span class="comment">// 2. 线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstace</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 创建时加锁，锁类</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过内部类来创建，和第一种类似，但是内部类不会在外部类加载的时候创建，只有在使用到的时候才会创建</span></span><br><span class="line"><span class="comment">// 1. 延迟创建</span></span><br><span class="line"><span class="comment">// 2. 线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonInner</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonInner.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举，利用枚举特性创建，本质上和第一种类似</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton</span>&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;单例模式&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#单例模式&quot;&gt;&lt;/a&gt; 单例模式&lt;/h2&gt;
&lt;blockquote&gt;&lt;p&gt;一个类只能有一个实例，并提供一个全局访问点&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;私有的构造方法&lt;/li&gt;
&lt;li&gt;私有
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>工厂模式</title>
    <link href="https://www.xiemx.com//2023/06/08/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <id>https://www.xiemx.com//2023/06/08/工厂模式/</id>
    <published>2023-06-08T02:52:41.000Z</published>
    <updated>2023-06-09T07:36:51.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="工厂模式"><a class="markdownIt-Anchor" href="#工厂模式"></a> 工厂模式</h2><p>对用户屏蔽对象的实例化的逻辑，降低了代码的耦合度，比方说我需要一台电脑，我不需要关心电脑的cpu、内存、主板怎么生产组装，只需要给用户一台组装好的机器即可，当我需要一台笔记本的时候，工厂只需要新增一个新的组装笔记本的逻辑即可。</p><p>工厂应该是一个抽象的结构，具体的实例化应该交给实现类来增加拓展性。</p><h3 id="简单工厂模式"><a class="markdownIt-Anchor" href="#简单工厂模式"></a> 简单工厂模式</h3><ol><li>工厂（电脑组装工厂）</li><li>产品类（电脑）</li><li>产品实现 （笔记本、台式机）</li></ol><h4 id="问题"><a class="markdownIt-Anchor" href="#问题"></a> 问题</h4><p>新增类型需要改动工厂，对象实例化都放在工厂内耦合度太高</p><h4 id="实现"><a class="markdownIt-Anchor" href="#实现"></a> 实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Notebook</span> <span class="keyword">extends</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Desktop</span> <span class="keyword">extends</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComputerFactory</span>()&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Computer <span class="title function_">getComputer</span><span class="params">(String type)</span> &#123;</span><br><span class="line">    <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">switch</span> () &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;notebook&quot;</span>:</span><br><span class="line">            computer = <span class="keyword">new</span> <span class="title class_">Notebook</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;desktop&quot;</span>:</span><br><span class="line">            computer = <span class="keyword">new</span> <span class="title class_">Desktop</span>();</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;不支持的类型&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> computer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="工厂方法模式"><a class="markdownIt-Anchor" href="#工厂方法模式"></a> 工厂方法模式</h3><p>可以简单理解为把工厂在抽象一层拆开成不同的desktop工厂、notebook工厂，把简单工厂里面的耦合实例化逻辑拆到具体的工厂上</p><ol><li>工厂方法 （工厂接口）</li><li>工厂实现（笔记本工厂、台式机工厂）</li><li>产品类 （电脑）</li><li>产品实现 （笔记本、台式机）</li></ol><h4 id="问题-2"><a class="markdownIt-Anchor" href="#问题-2"></a> 问题</h4><p>项目中类的数量变多</p><h4 id="实现-2"><a class="markdownIt-Anchor" href="#实现-2"></a> 实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    computer <span class="title function_">create</span><span class="params">()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotebookFactory</span> <span class="keyword">implements</span> <span class="title class_">Facotry</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Notebook  <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Notebook</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesktopFactory</span> <span class="keyword">implements</span> <span class="title class_">Facotry</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Desktop <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Desktop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;工厂模式&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#工厂模式&quot;&gt;&lt;/a&gt; 工厂模式&lt;/h2&gt;
&lt;p&gt;对用户屏蔽对象的实例化的逻辑，降低了代码的耦合度，比方说我需要一台电脑，我不需要关心电脑的cpu、内存、主板怎么生产组装，只需要给用
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>泛型协变</title>
    <link href="https://www.xiemx.com//2023/06/08/%E6%B3%9B%E5%9E%8B%E5%8D%8F%E5%8F%98/"/>
    <id>https://www.xiemx.com//2023/06/08/泛型协变/</id>
    <published>2023-06-08T01:47:20.000Z</published>
    <updated>2023-06-09T07:36:51.558Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题"><a class="markdownIt-Anchor" href="#问题"></a> 问题</h2><p>需要对中间件、应用2个类型的数据进行domain的数据进行解析，2应用都继承自CmdbBaseApp，此时parseDomain的时候接受参数 <code>List&lt;cmdbBaseApp&gt;</code> 类型，同时处理2种类型数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmdbBaseApp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String domain;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmdbMiddleResponse</span> <span class="keyword">extends</span> <span class="title class_">CmdbBaseApp</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmdbProjectResponse</span> <span class="keyword">extends</span> <span class="title class_">CmdbBaseApp</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseDomain</span><span class="params">(List&lt;CmdbBaseApp&gt; apps)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="现象"><a class="markdownIt-Anchor" href="#现象"></a> 现象</h2><p>编译报错</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用方法传入子类型时报错</span></span><br><span class="line">parseDomain(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;CmdbMiddleResponse&gt;());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">java: 不兼容的类型: java.util.ArrayList&lt;com.dada.alarm.model.CmdbMiddleResponse&gt;无法转换为java.util.List&lt;com.dada.alarm.model.CmdbBaseApp&gt;</span><br></pre></td></tr></table></figure><h2 id="解析"><a class="markdownIt-Anchor" href="#解析"></a> 解析</h2><p>由于数组是协变的，泛型是不变的，所以 <code>List&lt;CmdbMiddleResponse&gt;</code> 不等于 <code>List&lt;CmdbBaseApp&gt;</code>。</p><blockquote><p>数组是协变的，泛型是不变的。泛型可以通过通配符实现协变和逆变（pecs）。</p><footer><strong>《Effective java》</strong></footer></blockquote><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">解法一： 利用数组协变</span><br><span class="line"></span><br><span class="line">List&lt;CmdbBaseApp&gt; apps = <span class="keyword">new</span> ArrayList&lt;&gt;<span class="literal">()</span>;</span><br><span class="line">apps.add<span class="constructor">All(<span class="params">new</span> ArrayList&lt;CmdbMiddleResponse&gt;()</span>);</span><br><span class="line">apps.add<span class="constructor">All(<span class="params">new</span> ArrayList&lt;CmdbProjectResponse&gt;()</span>);</span><br><span class="line">parse<span class="constructor">Domain(<span class="params">apps</span>)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解法二： 泛型实现协变</span><br><span class="line"><span class="keyword">private</span> void parse<span class="constructor">Domain(List&lt;? <span class="params">extends</span> CmdbBaseApp&gt; <span class="params">apps</span>)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">parse<span class="constructor">Domain(<span class="params">new</span> ArrayList&lt;CmdbMiddleResponse&gt;()</span>);</span><br></pre></td></tr></table></figure><p>参考：<br /><a href="https://rumenz.com/java-topic/java/generics/java-generics-what-is-pecs-producer-extends-consumer-super/index.html">https://rumenz.com/java-topic/java/generics/java-generics-what-is-pecs-producer-extends-consumer-super/index.html</a><br /><a href="https://juejin.cn/post/6911302681583681544">https://juejin.cn/post/6911302681583681544</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;问题&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#问题&quot;&gt;&lt;/a&gt; 问题&lt;/h2&gt;
&lt;p&gt;需要对中间件、应用2个类型的数据进行domain的数据进行解析，2应用都继承自CmdbBaseApp，此时parseDomain的时候接受参数 
      
    
    </summary>
    
    
    
      <category term="java" scheme="https://www.xiemx.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>vue axios</title>
    <link href="https://www.xiemx.com//2021/02/15/vue-axios/"/>
    <id>https://www.xiemx.com//2021/02/15/vue-axios/</id>
    <published>2021-02-15T06:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.545Z</updated>
    
    <content type="html"><![CDATA[<p>vue 基础知识和用法</p><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><p><img src="/images/vue-axios.jpg" alt="vue-axios" /></p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.JS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerClick&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(value,key) in dataObj&quot;</span>&gt;</span></span><br><span class="line">                &#123;&#123; key&#125;&#125; = &#123;&#123;value&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataObj</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">get</span>(<span class="string">&#x27;https://mockbin.org/request&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>.<span class="property">headers</span>)</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">dataObj</span> = res.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">                &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue 基础知识和用法&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#效果&quot;&gt;&lt;/a&gt; 效果&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/vue-axios.jpg&quot; alt=&quot;vue-axios&quot; /&gt;&lt;/
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue fetch</title>
    <link href="https://www.xiemx.com//2021/02/15/vue-fetch/"/>
    <id>https://www.xiemx.com//2021/02/15/vue-fetch/</id>
    <published>2021-02-15T06:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.547Z</updated>
    
    <content type="html"><![CDATA[<p>vue 基础知识和用法</p><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><p><img src="/images/vue-fetch.jpg" alt="vue" /></p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.JS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerClick&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(value,key) in dataObj&quot;</span>&gt;</span></span><br><span class="line">                &#123;&#123; key&#125;&#125; = &#123;&#123;value&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataObj</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">fetch</span>(<span class="string">&#x27;https://mockbin.org/request&#x27;</span>).<span class="title function_">then</span>(</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> response.<span class="title function_">json</span>()</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                ).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">headers</span>)</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">dataObj</span> = res.<span class="property">headers</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue 基础知识和用法&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#效果&quot;&gt;&lt;/a&gt; 效果&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/vue-fetch.jpg&quot; alt=&quot;vue&quot; /&gt;&lt;/p&gt;
&lt;h3
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue ref</title>
    <link href="https://www.xiemx.com//2021/02/15/vue-ref/"/>
    <id>https://www.xiemx.com//2021/02/15/vue-ref/</id>
    <published>2021-02-15T06:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.548Z</updated>
    
    <content type="html"><![CDATA[<p>vue 通过ref 获取子组件属性</p><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><p><img src="/images/vue-ref.jpg" alt="vue" /></p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.js ref<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerClick&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        INPUT</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mytext&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        子组件</span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">ref</span>=<span class="string">&quot;mychild&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&quot;child&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">template</span>: <span class="string">`&lt;div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            </span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            child 属性</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;/div&gt;`</span></span></span><br><span class="line"><span class="language-javascript">        ,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">myvalue</span>: <span class="number">123123</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handlerClick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;输入的值为：&quot;</span>, <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">mytext</span>.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;子组件值为:&quot;</span>, <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">mychild</span>.<span class="property">myvalue</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue 通过ref 获取子组件属性&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#效果&quot;&gt;&lt;/a&gt; 效果&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/vue-ref.jpg&quot; alt=&quot;vue&quot; /&gt;&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue component slot</title>
    <link href="https://www.xiemx.com//2021/02/13/vue-slot/"/>
    <id>https://www.xiemx.com//2021/02/13/vue-slot/</id>
    <published>2021-02-13T07:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.548Z</updated>
    
    <content type="html"><![CDATA[<h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.js slot<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sidebar1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;isShow=!isShow&quot;</span>&gt;</span>侧边栏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sidebar1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sidebar2</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;a&quot;</span>&gt;</span>slot A <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">slot</span>=<span class="string">&quot;a&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;data in datalist&quot;</span>&gt;</span> &#123;&#123;data&#125;&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;b&quot;</span>&gt;</span>slot B <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sidebar2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    Vue.component(&#x27;sidebar1&#x27;, &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    Vue.component(&#x27;sidebar2&#x27;, &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        template: `<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background:red;width:200px&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    var vm = new Vue(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        el: &quot;#box&quot;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        data: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            isShow: false,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            datalist: [1111, 2222, 3333, 4444, 5555, 6666, 7777, 8888, 9999, 0000]</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;源码&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#源码&quot;&gt;&lt;/a&gt; 源码&lt;/h3&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cla
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue bus</title>
    <link href="https://www.xiemx.com//2021/02/13/vue-bus/"/>
    <id>https://www.xiemx.com//2021/02/13/vue-bus/</id>
    <published>2021-02-13T06:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.546Z</updated>
    
    <content type="html"><![CDATA[<p>vue 基础知识和用法</p><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><p><img src="/images/vue-bus.jpg" alt="vue" /></p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.js bus<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Author<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Subscriber<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">describe</span>&gt;</span><span class="tag">&lt;/<span class="name">describe</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> bus = <span class="keyword">new</span> <span class="title class_">Vue</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&quot;author&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">template</span>: <span class="string">`&lt;div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;input type=&quot;text&quot; ref=&quot;mytext&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;button @click=&quot;handlerClick&quot;&gt;发布&lt;/button&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;/div&gt;`</span></span></span><br><span class="line"><span class="language-javascript">        ,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handlerClick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发布文章&quot;</span>, <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">mytext</span>.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">                bus.$emit(<span class="string">&quot;t-message&quot;</span>, <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">mytext</span>.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;describe&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">template</span>: <span class="string">`&lt;div style=&quot;background:red;width=200px&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            订阅者</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;/div&gt;`</span></span></span><br><span class="line"><span class="language-javascript">        ,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            bus.$on(<span class="string">&quot;t-message&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到文章&quot;</span>, data)</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue 基础知识和用法&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#效果&quot;&gt;&lt;/a&gt; 效果&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/vue-bus.jpg&quot; alt=&quot;vue&quot; /&gt;&lt;/p&gt;
&lt;h3 i
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue component</title>
    <link href="https://www.xiemx.com//2021/02/13/vue-component/"/>
    <id>https://www.xiemx.com//2021/02/13/vue-component/</id>
    <published>2021-02-13T06:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.546Z</updated>
    
    <content type="html"><![CDATA[<p>vue componet</p><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><p><img src="/images/vue-component.jpg" alt="vue" /></p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.js 组件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navbar</span>&gt;</span><span class="tag">&lt;/<span class="name">navbar</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>动态传值 -- 父传子（属性）<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">:name</span>=<span class="string">&quot;myname&quot;</span> <span class="attr">:isshow</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">:name</span>=<span class="string">&quot;myname&quot;</span> <span class="attr">:isshow</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">:name</span>=<span class="string">&quot;myname&quot;</span> <span class="attr">:isshow</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;child :name=&quot;myname&quot; isshow=&quot;false&quot;&gt;&lt;/child&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;navbarChild&gt;&lt;/navbarChild&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>动态传值 -- 子传父（事件）<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        //$event 传参数为固定写法</span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> @<span class="attr">myevent</span>=<span class="string">&quot;handlerEvent($event)&quot;</span> <span class="attr">name</span>=<span class="string">&quot;付款&quot;</span> <span class="attr">:isshow</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>example<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sidebar1</span> @<span class="attr">sidebar-event</span>=<span class="string">&quot;handlerSEvent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sidebar1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sidebar2</span> <span class="attr">v-show</span>=<span class="string">isShow</span>&gt;</span><span class="tag">&lt;/<span class="name">sidebar2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    Vue.component(&quot;navbar&quot;, &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        template: `</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        <span class="tag">&lt;<span class="name">div</span>&gt;</span> </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;handlerClick&#x27;</span>&gt;</span>Newer<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>Older<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">child</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">navbarChild</span>&gt;</span><span class="tag">&lt;/<span class="name">navbarChild</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        components: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            // 内部组件</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            navbarChild: &#123; template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>navbar child 内部组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>` &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        methods: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            handlerClick() &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                console.log(&#x27;narvar&#x27;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    // 全局组件</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    Vue.component(&quot;child&quot;, &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        template: `</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                <span class="tag">&lt;<span class="name">button</span>&gt;</span>Child 全局组件 -- </span><span class="template-variable">&#123;&#123;<span class="name">name</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-show</span>=<span class="string">&quot;isshow&quot;</span>&gt;</span> isShow-- </span><span class="template-variable">&#123;&#123;<span class="name">isshow</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-show</span>=<span class="string">&quot;isshow&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handlerClick&quot;</span>&gt;</span> 付款 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            `,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // props: [&quot;name&quot;, &quot;isshow&quot;],   </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        props: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            name: String,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            isshow: Boolean,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            t: null    // null 表示不限制</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        methods: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            handlerClick() &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                console.log(this.count)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                this.$emit(&quot;myevent&quot;, this.count)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        data() &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            return &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                count: 100</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    Vue.component(&#x27;sidebar1&#x27;, &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerSClick&quot;</span>&gt;</span> 侧边栏 <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>`,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        methods: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            handlerSClick() &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                this.$emit(&quot;sidebar-event&quot;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    Vue.component(&#x27;sidebar2&#x27;, &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        template: `<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background:red;width:200px&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">li</span>&gt;</span> 11111 <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">li</span>&gt;</span> 11111 <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">li</span>&gt;</span> 11111 <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">li</span>&gt;</span> 11111 <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">li</span>&gt;</span> 11111 <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            <span class="tag">&lt;<span class="name">li</span>&gt;</span> 11111 <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span>     </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    var vm = new Vue(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        el: &quot;#box&quot;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        data: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            myname: &#x27;XXXX&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            isShow: false</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        methods: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            handlerEvent(ev) &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                console.log(&#x27;收到付款:&#x27;, ev)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            handlerSEvent() &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                this.isShow = !this.isShow</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue componet&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#效果&quot;&gt;&lt;/a&gt; 效果&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/vue-component.jpg&quot; alt=&quot;vue&quot; /&gt;&lt;/p
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue keepalived</title>
    <link href="https://www.xiemx.com//2021/02/13/vue-keepalived/"/>
    <id>https://www.xiemx.com//2021/02/13/vue-keepalived/</id>
    <published>2021-02-13T06:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.547Z</updated>
    
    <content type="html"><![CDATA[<p>vue 使用keepalived 避免组件被销毁，在内存中可保持数据</p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.js 组件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;whoami=&#x27;page1&#x27;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;whoami=&#x27;page2&#x27;&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;whoami=&#x27;page3&#x27;&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--  keep-alive 保持组件，避免重复渲染 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  component is属性 动态渲染组件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;whoami&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    var vm = new Vue(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        el: &quot;#box&quot;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        data: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            whoami: &#x27;page1&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        components: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &quot;page1&quot;: &#123; template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span> page1 <span class="tag">&lt;/<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span>&gt;</span>` &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &quot;page2&quot;: &#123; template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span> page2 <span class="tag">&lt;/<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span>&gt;</span>` &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &quot;page3&quot;: &#123; template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span> page3 <span class="tag">&lt;/<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span>&gt;</span>` &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue 使用keepalived 避免组件被销毁，在内存中可保持数据&lt;/p&gt;
&lt;h3 id=&quot;源码&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#源码&quot;&gt;&lt;/a&gt; 源码&lt;/h3&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;t
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue 计算属性</title>
    <link href="https://www.xiemx.com//2021/02/12/vue-computed/"/>
    <id>https://www.xiemx.com//2021/02/12/vue-computed/</id>
    <published>2021-02-12T06:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.547Z</updated>
    
    <content type="html"><![CDATA[<p>vue 方法会每次重新计算， computed会复用结果，见图调用次数</p><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><p><img src="/images/vue-computed.jpg" alt="vues" /></p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.JS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>方法：&#123;&#123;getName&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>计算属性：&#123;&#123;getNameMethods()&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>-----------------<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>方法：&#123;&#123;getName&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>计算属性：&#123;&#123;getNameMethods()&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">x</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">getNameMethods</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Methods&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="string">&#x27;123&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;computed&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="string">&#x27;123&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue 方法会每次重新计算， computed会复用结果，见图调用次数&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#效果&quot;&gt;&lt;/a&gt; 效果&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/vue-compute
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue v-bind等基础用法</title>
    <link href="https://www.xiemx.com//2021/02/10/vue-notebook-1/"/>
    <id>https://www.xiemx.com//2021/02/10/vue-notebook-1/</id>
    <published>2021-02-10T02:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.548Z</updated>
    
    <content type="html"><![CDATA[<p>vue 基础知识和用法</p><h3 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h3><p><img src="/images/vue-note-1.jpg" alt="vue-note-1" /></p><h3 id="源码"><a class="markdownIt-Anchor" href="#源码"></a> 源码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue.js<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;isActive?&#x27;red&#x27;:&#x27;yellow&#x27;&quot;</span>&gt;</span>三目<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;classArr&quot;</span>&gt;</span>array<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;classObj&quot;</span>&gt;</span>object<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;&#x27;background:&#x27; + (isActive?&#x27;red&#x27;:&#x27;blue&#x27;)&quot;</span>&gt;</span>三目<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;styleObj&quot;</span>&gt;</span>object<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;styleArr&quot;</span>&gt;</span>array<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">            鼠标悬停几秒钟查看此处动态绑定的提示信息！</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span>v-show<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;isCreated&quot;</span>&gt;</span>v-if<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>v-else<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-if</span>=<span class="string">&quot;datalist.length&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;data in datalist&quot;</span>&gt;</span> &#123;&#123;data&#125;&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span> empty datalist<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerClick&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(data, index) in dataArr&quot;</span>&gt;</span></span><br><span class="line">                    &#123;&#123;data&#125;&#125; -- &#123;&#123;index&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(vaule, key) in dataObj&quot;</span>&gt;</span></span><br><span class="line">                    &#123;&#123;key&#125;&#125; -- &#123;&#123;vaule&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>按键触发:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;handlerInput&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;filtertext&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>事件触发:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;handlerInput&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;filtertext&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>焦点触发:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;handlerInput&quot;</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;filtertext&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in filterlist&quot;</span>&gt;</span></span><br><span class="line">                    &#123;&#123;item&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> @<span class="attr">click</span>=<span class="string">&quot;handlerUlClick&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> @<span class="attr">click.stop</span>=<span class="string">&quot;handlerLiClick&quot;</span>&gt;</span>Stop<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.once</span>=<span class="string">&quot;handlerLiClick&quot;</span>&gt;</span>Once<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;isRemember&quot;</span> <span class="attr">value</span>=<span class="string">&quot;isRemember&quot;</span>&gt;</span>Remember me</span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            &#123;&#123;langs&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">checkbox</span> <span class="attr">v-model</span>=<span class="string">&quot;langs&quot;</span> <span class="attr">value</span>=<span class="string">&quot;python&quot;</span>&gt;</span> python</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">checkbox</span> <span class="attr">v-model</span>=<span class="string">&quot;langs&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java&quot;</span>&gt;</span> java</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">checkbox</span> <span class="attr">v-model</span>=<span class="string">&quot;langs&quot;</span> <span class="attr">value</span>=<span class="string">&quot;golang&quot;</span>&gt;</span> golang</span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            &#123;&#123;fruit&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;apple&quot;</span>&gt;</span> apple</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;banana&quot;</span>&gt;</span> banana</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pear&quot;</span>&gt;</span> pear</span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        购物车：</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;handlerChange&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;isAll&quot;</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;product in products&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;checkoutPrices&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;product&quot;</span></span></span><br><span class="line"><span class="tag">                        @<span class="attr">change</span>=<span class="string">&quot;handlerliChange&quot;</span>&gt;</span>&#123;&#123;product.name&#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handlerDelClick(product)&quot;</span>&gt;</span>Del<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    &#123;&#123;product.number&#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;product.number++&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;&#123;checkoutPrices&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>总金额：&#123;&#123; getSum() &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">message</span>: <span class="string">&quot;123123&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">html</span>: <span class="string">&quot;&lt;a href=#&gt;super man&lt;/a&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">isShow</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">isCreated</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">isActive</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">isRemember</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">classObj</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;red&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;yellow&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">classArr</span>: [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;yellow&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">styleObj</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">background</span>: <span class="string">&quot;red&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">styleArr</span>: [&#123; <span class="attr">background</span>: <span class="string">&quot;blue&quot;</span> &#125;, &#123; <span class="attr">fontSize</span>: <span class="string">&quot;40px&quot;</span> &#125;],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">datalist</span>: [],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataArr</span>: [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataObj</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">keyA</span>: <span class="string">&quot;vauleA&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">keyB</span>: <span class="string">&quot;vauleB&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">keyC</span>: <span class="string">&quot;vauleC&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">filtertext</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">filterlist</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;bear&quot;</span>, <span class="string">&quot;able&quot;</span>, <span class="string">&quot;application&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">list</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;bear&quot;</span>, <span class="string">&quot;able&quot;</span>, <span class="string">&quot;application&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">langs</span>: [],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">fruit</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">products</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">name</span>: <span class="string">&quot;A&quot;</span>, <span class="attr">price</span>: <span class="number">1</span>, <span class="attr">number</span>: <span class="number">2</span>, <span class="attr">id</span>: <span class="number">1</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">name</span>: <span class="string">&quot;B&quot;</span>, <span class="attr">price</span>: <span class="number">1.1</span>, <span class="attr">number</span>: <span class="number">3</span>, <span class="attr">id</span>: <span class="number">2</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">name</span>: <span class="string">&quot;C&quot;</span>, <span class="attr">price</span>: <span class="number">1.2</span>, <span class="attr">number</span>: <span class="number">2</span>, <span class="attr">id</span>: <span class="number">3</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">name</span>: <span class="string">&quot;D&quot;</span>, <span class="attr">price</span>: <span class="number">2</span>, <span class="attr">number</span>: <span class="number">1</span>, <span class="attr">id</span>: <span class="number">4</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">            ],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">checkoutPrices</span>: [],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">isAll</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">isCreated</span> = !<span class="variable language_">this</span>.<span class="property">isCreated</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">datalist</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerInput</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">filterlist</span> = <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> !item.<span class="title function_">indexOf</span>(<span class="variable language_">this</span>.<span class="property">filtertext</span>))</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerUlClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ul click&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(event)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerLiClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// event.stopPropagation()</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;li click&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(event)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">getSum</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> sum = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">checkoutPrices</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    sum += <span class="variable language_">this</span>.<span class="property">checkoutPrices</span>[i].<span class="property">number</span> * <span class="variable language_">this</span>.<span class="property">checkoutPrices</span>[i].<span class="property">price</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> sum</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerChange</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAll</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">checkoutPrices</span> = <span class="variable language_">this</span>.<span class="property">products</span></span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">checkoutPrices</span> = []</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerliChange</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">checkoutPrices</span>.<span class="property">length</span> == <span class="variable language_">this</span>.<span class="property">products</span>.<span class="property">length</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">isAll</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123; <span class="variable language_">this</span>.<span class="property">isAll</span> = <span class="literal">false</span> &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">handlerDelClick</span>: <span class="keyword">function</span> (<span class="params">product</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(product)</span></span><br><span class="line"><span class="language-javascript">                product.<span class="property">number</span>--</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (product.<span class="property">number</span> &lt;= <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    product.<span class="property">number</span> = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">checkoutPrices</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">checkoutPrices</span>[i].<span class="property">id</span> === product.<span class="property">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">checkoutPrices</span>.<span class="title function_">splice</span>(i, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;vue 基础知识和用法&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#效果&quot;&gt;&lt;/a&gt; 效果&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/vue-note-1.jpg&quot; alt=&quot;vue-note-1&quot; /&gt;
      
    
    </summary>
    
    
      <category term="vue" scheme="https://www.xiemx.com/categories/vue/"/>
    
    
      <category term="vue" scheme="https://www.xiemx.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>alicloud k8s 日志接入 sls</title>
    <link href="https://www.xiemx.com//2020/12/17/aliyun-ack-sls/"/>
    <id>https://www.xiemx.com//2020/12/17/aliyun-ack-sls/</id>
    <published>2020-12-17T02:01:04.000Z</published>
    <updated>2023-06-09T07:36:51.483Z</updated>
    
    <content type="html"><![CDATA[<h2 id="采集原理"><a class="markdownIt-Anchor" href="#采集原理"></a> 采集原理</h2><p>通过 DaemonSet 模式在每个 node 上运行 logtail client，客户端启动后加入指定 machine-group，通过 docker.sock 与 ecs 上的 docker daemon 通讯，通过检索 container 环境变量来查找符合采集规则的 container，以及定位内部文件和容器 stdout 日志，在通过监听内核 inotify 事件来进行日志文件变化监听。</p><h2 id="pod-日志接入模式环境变量注入"><a class="markdownIt-Anchor" href="#pod-日志接入模式环境变量注入"></a> Pod 日志接入模式（环境变量注入）</h2><p>通过在pod中注入环境变量aliyun_logs_{key} 来接入aliyun SLS日志系统，如未指定project 则使用在DaemonSet 模式默认部署的 logtail 默认配置。</p><h2 id="logtail-ds-configmap"><a class="markdownIt-Anchor" href="#logtail-ds-configmap"></a> logtail-ds configMap</h2><p>采集插件安装不再赘述</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">cpu-core-limit:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">  <span class="attr">log-ali-uid:</span> <span class="string">&quot;163139xxxxxxxx497&quot;</span></span><br><span class="line">  <span class="attr">log-config-path:</span> <span class="string">/etc/ilogtail/conf/cn-hangzhou/ilogtail_config.json</span></span><br><span class="line">  <span class="attr">log-endpoint:</span> <span class="string">cn-hangzhou-intranet.log.aliyuncs.com</span></span><br><span class="line">  <span class="attr">log-machine-group:</span> <span class="string">k8s-group-cbe7f0d404866409exxxxxxcefeda</span></span><br><span class="line">  <span class="attr">log-project:</span> <span class="string">k8s-log-c79a7ce35db39488xxxxxx9432e53e6</span></span><br><span class="line">  <span class="attr">max-bytes-per-sec:</span> <span class="string">&quot;209715200&quot;</span></span><br><span class="line">  <span class="attr">mem-limit:</span> <span class="string">&quot;512&quot;</span></span><br><span class="line">  <span class="attr">send-requests-concurrency:</span> <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">alibaba-log-configuration</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure><h2 id="环境变量"><a class="markdownIt-Anchor" href="#环境变量"></a> 环境变量</h2><table><thead><tr><th>支持的环境变量</th><th></th><th></th></tr></thead><tbody><tr><td>aliyun_logs_{key}</td><td>必选项。{key}只能包含小写字母、数字和-。若不存在aliyun_logs_{key}_logstore，则默认创建并采集到名为{key}的logstore。当值为stdout表示采集容器的标准输出；其他值为容器内的日志路径。</td><td>默认采集方式为极简模式, {key}需保持在K8s集群内唯一。</td></tr><tr><td>aliyun_logs_{key}_tags</td><td>可选。值为{tag-key}={tag-value}类型，用于对日志进行标识。</td><td>-</td></tr><tr><td>aliyun_logs_{key}_project</td><td>可选。值为指定的日志服务Project。当不存在该环境变量时为您安装时所选的Project。</td><td>Project需与您的Logtail工作所在Region一致。</td></tr><tr><td>aliyun_logs_{key}_logstore</td><td>可选。值为指定的日志服务Logstore。当不存在该环境变量时Logstore和{key}一致。</td><td>-</td></tr><tr><td>aliyun_logs_{key}_shard</td><td>可选。值为创建Logstore时的shard数，有效值为1~10。当不存在该环境变量时值为2。</td><td>-</td></tr><tr><td>aliyun_logs_{key}_ttl</td><td>可选。值为指定的日志保存时间，有效值为1~3650。当取值为3650时，指定日志的保存时间为永久保存。当不存在该环境变量时，默认指定日志的保存时间为90天。</td><td>-</td></tr><tr><td>aliyun_logs_{key}_machinegroup</td><td>可选。值为应用的机器组。当不存在该环境变量时与安装Logtail的默认机器组一致。</td><td>-</td></tr></tbody></table><hr /><h2 id="example"><a class="markdownIt-Anchor" href="#example"></a> Example</h2><h3 id="step1"><a class="markdownIt-Anchor" href="#step1"></a> Step1</h3><p>创建测试容器，并注入环境变量</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">template:</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/instance:</span> <span class="string">xiemx-training</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/name:</span> <span class="string">xiemx-training</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">aliyun_logs_xiemx-training-stdout-log</span></span><br><span class="line">        <span class="attr">value:</span> <span class="string">stdout</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.16.0</span></span><br></pre></td></tr></table></figure><h3 id="step-2"><a class="markdownIt-Anchor" href="#step-2"></a> Step 2</h3><p>此时阿里云SLS日志服务中即会创建logStore，默认 logtail 为极简模式，日志未进行解析。</p><div align=center><img src="/images/ali-sls-logstore.png"></div><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;IncludeEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;aliyun_logs_xiemx-training-stdout-log&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stdout&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Stderr&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Stdout&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;service_docker_stdout&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="step-3"><a class="markdownIt-Anchor" href="#step-3"></a> Step 3</h3><p>进行日志拆分极细，aliyun支持多种解析插件，当前使用自定义的正则来演示，logtail 配置如下。<br />插件可参考：<a href="https://help.aliyun.com/document_detail/64957.html?spm=a2c4g.11186623.6.640.60a31de3orfOsD">https://help.aliyun.com/document_detail/64957.html?spm=a2c4g.11186623.6.640.60a31de3orfOsD</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;IncludeEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;aliyun_logs_xiemx-training-stdout-log&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stdout&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Stderr&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Stdout&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;service_docker_stdout&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;processors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;KeepSource&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;NoMatchError&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Keys&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;remote_addr&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;time&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;http_method&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;request_uri&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;status_code&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;body_bytes_sent&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;http_referer&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;user_agent&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;http_x_forwarded_for&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;SourceKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;content&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Regex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(\\S+) \\S+ \\S+ \\[(\\S+) \\S+\\] \&quot;([A-Z]+) (.*)\&quot; (\\d+) (\\S+) \&quot;(\\S+)\&quot; \&quot;(.*)\&quot; \&quot;(.*)\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;NoKeyError&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;processor_regex&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>需要注意：当使用 regex 进行分组时，请务必不要使用 <code>(()())</code> 类似嵌套表达式会导致日志解析结果和 Key 对应关系错乱，日志数据混乱。如下例子：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">((\d+\.)</span>&#123;<span class="number">3</span>&#125;<span class="comment">(\d+)</span>)  --替换-&gt; <span class="comment">(\S+)</span></span><br></pre></td></tr></table></figure><h3 id="step-4"><a class="markdownIt-Anchor" href="#step-4"></a> Step 4</h3><p>此时如果正则解析无问题的情况下即可查看拆分后的日志，如没有查看到拆分的日志，可点击诊断按钮查看客户端错误进行debug。</p><div align=center><img src="/images/ali-sls-search.png"></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;采集原理&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#采集原理&quot;&gt;&lt;/a&gt; 采集原理&lt;/h2&gt;
&lt;p&gt;通过 DaemonSet 模式在每个 node 上运行 logtail client，客户端启动后加入指定 machine-grou
      
    
    </summary>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/categories/k8s/"/>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/tags/k8s/"/>
    
      <category term="aliyun" scheme="https://www.xiemx.com/tags/aliyun/"/>
    
  </entry>
  
  <entry>
    <title>Ingress Controller V2 TargetGroupBinding使用方法</title>
    <link href="https://www.xiemx.com//2020/12/03/aws-targetgroupbinding/"/>
    <id>https://www.xiemx.com//2020/12/03/aws-targetgroupbinding/</id>
    <published>2020-12-03T02:52:00.000Z</published>
    <updated>2023-06-09T07:36:51.487Z</updated>
    
    <content type="html"><![CDATA[<p>Ingress Controller V2 TargetGroupBinding使用方法 场景<br />实现EC2到EKS的平滑过渡，想在暴露EKS Ingress的时候使用原来给EC2使用的ALB，因此可以使用Ingress Controller V2版本的TargetGroupBinding新功能。<br />Demo步骤</p><ul><li>安装ALBIngressControllerv2版本, 或将v1版本迁移至v2<ul><li><a href="https://kubernetes-sigs.github.io/aws-load-balancer-controller/guide/controller/installation/">https://kubernetes-sigs.github.io/aws-load-balancer-controller/guide/controller/installation/</a></li><li><a href="https://kubernetes-sigs.github.io/aws-load-balancer-controller/guide/upgrade/migrate_v1_v2/">https://kubernetes-sigs.github.io/aws-load-balancer-controller/guide/upgrade/migrate_v1_v2/</a></li></ul></li><li>创建一个新的targetgroup，并记录下arn，后续要把该arn写到TargetGroupBinding的CR当中</li><li>在alb上配置到目标组的路由策略<ul><li><img src="/images/aws-tgbinding.jpg" alt="tgbinding-rule" /></li></ul></li><li>赋予nodegroup上的iam role能够注册到目标组的权限</li><li>创建ns/deployment/services</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">wormhole</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">wormhole</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">progressDeadlineSeconds:</span> <span class="number">600</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">wormhole</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">wormhole</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">wormhole</span></span><br><span class="line">        <span class="attr">service:</span> <span class="string">wormhole</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">envFrom:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">wormhole</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">wormhole</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">http-web</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">https-web</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">node.kubernetes.io/service-type:</span> <span class="string">product</span></span><br><span class="line">        <span class="attr">node.kubernetes.io/workload-type:</span> <span class="string">stateless</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">wormhole-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">externalTrafficPolicy:</span> <span class="string">Local</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">http-web</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">https-web</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">wormhole</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure><ul><li>service暴露完成之后，不再需要创建ingress了，直接和targetgroup进行绑定，（kubectl logs aws-load-balancer-controller-xxx -f -n kube-system可查看是否发生错误)，注册到目标组的方式通过targetType来指定，支持ip与instance两种方式，绑定后，实例或ip会自动注册到目标组中<ul><li><pre class="highlight"><code class="yaml">  <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">elbv2.k8s.aws/v1alpha1</span>  <span class="hljs-attr">kind:</span> <span class="hljs-string">TargetGroupBinding</span>  <span class="hljs-attr">metadata:</span>     <span class="hljs-attr">name:</span> <span class="hljs-string">wormhole-tg-bind</span>  <span class="hljs-attr">spec:</span>    <span class="hljs-attr">targetType:</span> <span class="hljs-string">instance</span>  <span class="hljs-attr">serviceRef:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">wormhole-svc</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>  <span class="hljs-attr">targetGroupArn:</span> <span class="hljs-string">arn:aws:elasticloadbalancer:xxxxxx:xxxxxxxx:targetgroup/tg-bind</span></code></pre></li><li><img src="/images/aws-tgbinding-ec2.jpg" alt="aws-tgbinding-ec2" /></li></ul></li></ul><hr /><p><strong>注意</strong></p><ul><li>和一般的ingress不同，路由策略要在alb侦听器上自行编辑</li><li>实例端口也不会自动在安全组中开放，需要在node使用的安全组上自行打开</li><li>node需要有足够的权限注册到目标组中</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Ingress Controller V2 TargetGroupBinding使用方法 场景&lt;br /&gt;
实现EC2到EKS的平滑过渡，想在暴露EKS Ingress的时候使用原来给EC2使用的ALB，因此可以使用Ingress Controller V2版本的Targe
      
    
    </summary>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/categories/k8s/"/>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8s services iptables规则探究</title>
    <link href="https://www.xiemx.com//2020/12/03/k8s-services-iptables/"/>
    <id>https://www.xiemx.com//2020/12/03/k8s-services-iptables/</id>
    <published>2020-12-03T02:52:00.000Z</published>
    <updated>2023-06-09T07:36:51.505Z</updated>
    
    <content type="html"><![CDATA[<h3 id="结论"><a class="markdownIt-Anchor" href="#结论"></a> 结论</h3><p>本文只讨论iptables的services实现，ipvs实现有所不同，这里先说结论如下：</p><ul><li>service 使用iptables 来进行pod的dnat，services本身只是一条虚拟的iptables规则，不存在实体。</li><li>service 使用iptales 扩展模块来实现pod轮询策略故而无法实现最小链接数等负载算法<ul><li>多pod下的RR实现使用iptables statistic模块的random算法加权实现</li><li>sessionAffinity 使用iptables recent模块实现保持，功能主要依赖于nf_conntrack来实现连接标记</li></ul></li></ul><hr /><h4 id="单pod时service-iptables-规则实现"><a class="markdownIt-Anchor" href="#单pod时service-iptables-规则实现"></a> 单pod时service iptables 规则实现</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx pod ip地址：</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl describe pod nginx-fb8d45fxt-dcc1t | grep <span class="string">&quot;IP&quot;</span></span></span><br><span class="line"></span><br><span class="line">IP:             10.200.1.21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Service服务，通过172.30.13.253:80则实际访问到10.200.1.21:80</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl describe svc nginx</span></span><br><span class="line">...</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                172.30.13.25</span><br><span class="line">Port:              &lt;unset&gt;  80/TCP</span><br><span class="line">TargetPort:        80/TCP</span><br><span class="line">Endpoints:         10.200.1.21:80</span><br><span class="line">Session Affinity:  None</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">iptables-save (选取部分关键规则)</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">-A PREROUTING -m comment --comment &quot;kubernetes service portals&quot; -j KUBE-SERVICES</span><br><span class="line">-A OUTPUT -m comment --comment &quot;kubernetes service portals&quot; -j KUBE-SERVICES</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">-A KUBE-SEP-UWNFTKZFYWNNNTK7 -s 10.200.1.21/32 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-UWNFTKZFYWNNNTK7 -p tcp -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m tcp -j DNAT --to-destination 10.200.1.21:80</span><br><span class="line">-A KUBE-SERVICES -d 172.30.13.25/32 -p tcp -m comment \</span><br><span class="line">   --comment &quot;demo/nginx: cluster IP&quot; -m tcp --dport 80 -j KUBE-SVC-1T7IBBNZDJ76</span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-SEP-UWNFTKZFYWNNNTK7</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="分析"><a class="markdownIt-Anchor" href="#分析"></a> 分析：</h4><p>当访问 172.30.13.25/32 的80 端口时，iptables 规则会被第三条规则命中KUBE-SERVICES，在转发到 KUBE-SVC-1T7IBBNZDJ76 链 ，KUBE-SVC-1T7IBBNZDJ76链对流量进行comment标记之后 转发到 KUBE-SEP-UWNFTKZFYWNNNTK7<br />该链上实现了第一条访问外网的和一条对内的DNAT，此时是向内访问规则会命中第二条向内部进行DNAT 转发到pod地址上，进行路由寻址。</p><hr /><h3 id="负载算法实现"><a class="markdownIt-Anchor" href="#负载算法实现"></a> 负载算法实现</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl scale deploy/nginx --replicas=3</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">iptables-save (选取部分规则)</span></span><br><span class="line">-A KUBE-SEP-BI123VOIAZZ5S7 -s 10.129.1.12/32 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-BI123VOIAZZ5S7 -p tcp -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m tcp -j DNAT --to-destination 10.129.1.12:80</span><br><span class="line"></span><br><span class="line">-A KUBE-SEP-CDQIKASRG66RK -s 10.129.1.13/32 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-CDQIKASRG66RK -p tcp -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m tcp -j DNAT --to-destination 10.129.1.13:80</span><br><span class="line"></span><br><span class="line">-A KUBE-SEP-W5HTO42ZVNHJQWBG -s 10.129.1.14/32 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-W5HTO42ZVNHJQWBG -p tcp -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m tcp -j DNAT --to-destination 10.129.1.14:80</span><br><span class="line"></span><br><span class="line">-A KUBE-SERVICES -d 172.30.13.25/32 -p tcp -m comment \</span><br><span class="line">   --comment &quot;demo/nginx: cluster IP&quot; -m tcp --dport 80 -j KUBE-SVC-1T7IBBNZDJ76</span><br><span class="line"></span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-BI123VOIAZZ5S7</span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-CDQIKASRG66RK</span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-SEP-W5HTO42ZVNHJQWBG</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="分析-2"><a class="markdownIt-Anchor" href="#分析-2"></a> 分析：</h3><p>iptable 在实现多pod 负载算法的时候使用了 statistic模块的random 加权算法 <code>-m statistic --mode random --probability 0.33332999982 </code>来实现。具体模块用法可以参考：<a href="http://ipset.netfilter.org/iptables-extensions.man.html">http://ipset.netfilter.org/iptables-extensions.man.html</a></p><hr /><h3 id="会话保持"><a class="markdownIt-Anchor" href="#会话保持"></a> 会话保持</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl edit svc nginx</span></span><br><span class="line">...</span><br><span class="line">  sessionAffinity: ClientIP</span><br><span class="line">  sessionAffinityConfig:</span><br><span class="line">    clientIP:</span><br><span class="line">      timeoutSeconds: 3600</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">iptables-save (选取部分规则)</span> </span><br><span class="line">-A KUBE-SEP-BI123VOIAZZ5S7 -s 10.129.1.12/32 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-BI123VOIAZZ5S7 -p tcp -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m recent --set --name KUBE-SEP-BI123VOIAZZ5S7 --mask 255.255.255.255 \</span><br><span class="line">   --rsource -m tcp -j DNAT --to-destination 10.129.1.12:80</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">-A KUBE-SERVICES -d 172.30.13.25/32 -p tcp -m comment \</span><br><span class="line">   --comment &quot;demo/nginx: cluster IP&quot; -m tcp --dport 80 -j KUBE-SVC-1T7IBBNZDJ76</span><br><span class="line"></span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m recent --rcheck --seconds 3600 --reap --name KUBE-SEP-BI123VOIAZZ5S7 \</span><br><span class="line">   --mask 255.255.255.255 --rsource -j KUBE-SEP-BI123VOIAZZ5S7</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m statistic --mode random --probability 0.33332999982 -j KUBE-SEP-BI123VOIAZZ5S7</span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-CDQIKASRG66RK</span><br><span class="line">-A KUBE-SVC-1T7IBBNZDJ76 -m comment --comment &quot;demo/nginx:&quot; \</span><br><span class="line">   -j KUBE-SEP-W5HTO42ZVNHJQWBG</span><br></pre></td></tr></table></figure><h4 id="分析-3"><a class="markdownIt-Anchor" href="#分析-3"></a> 分析</h4><p>iptables 主要使用recent 模块来标记追踪连接状态 <code>-m recent --rcheck --seconds 3600</code>来完成会话保持。具体recent模块用法可以参考：<a href="http://ipset.netfilter.org/iptables-extensions.man.html">http://ipset.netfilter.org/iptables-extensions.man.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;结论&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#结论&quot;&gt;&lt;/a&gt; 结论&lt;/h3&gt;
&lt;p&gt;本文只讨论iptables的services实现，ipvs实现有所不同，这里先说结论如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;service 使用ipt
      
    
    </summary>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/categories/k8s/"/>
    
      <category term="iptables" scheme="https://www.xiemx.com/categories/k8s/iptables/"/>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/tags/k8s/"/>
    
      <category term="iptables" scheme="https://www.xiemx.com/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>k8s cluster-autoscaler</title>
    <link href="https://www.xiemx.com//2020/12/02/k8s-cluster-autoscaler/"/>
    <id>https://www.xiemx.com//2020/12/02/k8s-cluster-autoscaler/</id>
    <published>2020-12-02T09:05:04.000Z</published>
    <updated>2023-06-09T07:36:51.495Z</updated>
    
    <content type="html"><![CDATA[<p>为了在集群中能够动态的根据pod的资源使用量来进行node的动态扩容，K8S cluster-autoscaler 提供了这样的功能，目前接入了大部分主流的厂商，由于我们使用的是aws eks，这里只进行aws 编排。</p><ul><li>项目地址：<a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler</a></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-addon:</span> <span class="string">cluster-autoscaler.addons.k8s.io</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-addon:</span> <span class="string">cluster-autoscaler.addons.k8s.io</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>, <span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;pods/eviction&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;pods/status&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;update&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">    <span class="attr">resourceNames:</span> [<span class="string">&quot;cluster-autoscaler&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;pods&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;services&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;replicationcontrollers&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;persistentvolumeclaims&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;persistentvolumes&quot;</span></span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;replicasets&quot;</span>, <span class="string">&quot;daemonsets&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;policy&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;poddisruptionbudgets&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;statefulsets&quot;</span>, <span class="string">&quot;replicasets&quot;</span>, <span class="string">&quot;daemonsets&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>, <span class="string">&quot;csinodes&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;batch&quot;</span>, <span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;jobs&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;coordination.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;leases&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;coordination.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resourceNames:</span> [<span class="string">&quot;cluster-autoscaler&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;leases&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-addon:</span> <span class="string">cluster-autoscaler.addons.k8s.io</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;configmaps&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;watch&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;configmaps&quot;</span>]</span><br><span class="line">    <span class="attr">resourceNames:</span> [<span class="string">&quot;cluster-autoscaler-status&quot;</span>, <span class="string">&quot;cluster-autoscaler-priority-expander&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;delete&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-addon:</span> <span class="string">cluster-autoscaler.addons.k8s.io</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-addon:</span> <span class="string">cluster-autoscaler.addons.k8s.io</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">cluster-autoscaler.kubernetes.io/safe-to-evict:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">prometheus.io/scrape:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">        <span class="attr">prometheus.io/port:</span> <span class="string">&#x27;8085&#x27;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">node.kubernetes.io/service-type:</span> <span class="string">auxiliary</span></span><br><span class="line">        <span class="attr">node.kubernetes.io/workload-type:</span> <span class="string">stateless</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">k8s.gcr.io/autoscaling/cluster-autoscaler:v1.17.3</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">cluster-autoscaler</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">300Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">300Mi</span></span><br><span class="line">          <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">./cluster-autoscaler</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--v=4</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--stderrthreshold=info</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--cloud-provider=aws</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--skip-nodes-with-local-storage=true</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--expander=least-waste</span></span><br><span class="line">            <span class="comment"># 我们这里使用自动发现模式，将底层的机器配置，spot/on-daemon机器比例等等逻辑放到aws autoscaling group中去，通过配置的tag寻找对应的asg组，建议使用此方法也可参考官网使用其它模式。</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--node-group-auto-discovery=asg:tag=k8s.io/cluster-autoscaler/enabled,kubernetes.io/cluster/aux-eks</span> </span><br><span class="line">            <span class="comment"># - --balance-similar-node-groups</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--skip-nodes-with-system-pods=false</span></span><br><span class="line">            <span class="comment"># - --aws-use-static-instance-list=true</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ssl-certs</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/ssl/certs/ca-certificates.crt</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">&quot;Always&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ssl-certs</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/etc/ssl/certs/ca-bundle.crt&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="现象"><a class="markdownIt-Anchor" href="#现象"></a> 现象</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  cluster-autoscaler git:(master) k get pod -A | grep auto</span><br><span class="line">kube-system              cluster-autoscaler-6f5dcc568c-xsbgc                          1/1     Running     1          66d</span><br><span class="line"></span><br><span class="line">➜  k logs -f -n kube-system cluster-autoscaler-6f5dcc568c-xsbgc</span><br><span class="line"></span><br><span class="line">I1203 07:59:42.152656       1 static_autoscaler.go:194] Starting main loop</span><br><span class="line">I1203 07:59:42.153624       1 clusterstate.go:252] Scale up in group aux-eks-product-stateless-20200814145032009600000010 finished successfully in 2m10.67671515s</span><br><span class="line">...</span><br><span class="line">I1203 08:00:02.185930       1 static_autoscaler.go:194] Starting main loop</span><br><span class="line">I1203 08:00:02.337720       1 auto_scaling_groups.go:351] Regenerating instance to ASG map for ASGs: [aux-eks-auxiliary-stateful-2020081414503199620000000e aux-eks-auxiliary-stateless-2020081414503200200000000f aux-eks-product-stateful-2020081414503199420000000d aux-eks-product-stateless-20200814145032009600000010]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意</h3><ul><li>cluster-autoscaler 通过计算node 上pod的request/limit来分析资源是否存在不足，因此建议对pod进行明确的资源限制</li><li>node 扩容时尽量选择同配置的机型，或CPU/Memory相同的机型。如果需要使用不同机型可以针对资源进行编组，扩容时按需选择不同的组进行扩容。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;为了在集群中能够动态的根据pod的资源使用量来进行node的动态扩容，K8S cluster-autoscaler 提供了这样的功能，目前接入了大部分主流的厂商，由于我们使用的是aws eks，这里只进行aws 编排。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;项目地址：&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/categories/k8s/"/>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/tags/k8s/"/>
    
      <category term="cluster-autoscaler" scheme="https://www.xiemx.com/tags/cluster-autoscaler/"/>
    
  </entry>
  
  <entry>
    <title>k8s descheduler</title>
    <link href="https://www.xiemx.com//2020/12/01/k8s-descheduler/"/>
    <id>https://www.xiemx.com//2020/12/01/k8s-descheduler/</id>
    <published>2020-12-01T09:05:04.000Z</published>
    <updated>2023-06-09T07:36:51.495Z</updated>
    
    <content type="html"><![CDATA[<h3 id="原理"><a class="markdownIt-Anchor" href="#原理"></a> 原理</h3><p>kube-scheduler通过各种算法计算出最佳节点去运行Pod,当出现新的 Pod 进行调度时，调度程序会根据其当时对 Kubernetes 集群的资源做出调度决定。但Kubernetes集群发生变化，比如一个节点为了维护，执行了驱逐操作，这个节点的 Pod 会被驱逐到其他节点，但是当我们维护完成Pod 不会自动回到该节点上来，由此 Kubernetes 集群出现了不均衡的状态，可以使用descheduler进行在均衡。</p><ul><li>项目地址：<a href="https://github.com/kubernetes-sigs/descheduler">https://github.com/kubernetes-sigs/descheduler</a></li></ul><h3 id="install-descheduler"><a class="markdownIt-Anchor" href="#install-descheduler"></a> install descheduler</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">descheduler-policy-configmap</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">policy.yaml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    apiVersion: &quot;descheduler/v1alpha1&quot;</span></span><br><span class="line"><span class="string">    kind: &quot;DeschedulerPolicy&quot;</span></span><br><span class="line"><span class="string">    strategies:</span></span><br><span class="line"><span class="string">      &quot;RemoveDuplicates&quot;:</span></span><br><span class="line"><span class="string">        enabled: true</span></span><br><span class="line"><span class="string">        params:</span></span><br><span class="line"><span class="string">          removeDuplicates:</span></span><br><span class="line"><span class="string">            excludeOwnerKinds:</span></span><br><span class="line"><span class="string">            - &quot;DaemonSet&quot;</span></span><br><span class="line"><span class="string">            - &quot;StatefulSet&quot;</span></span><br><span class="line"><span class="string">            namespaces:</span></span><br><span class="line"><span class="string">              include:</span></span><br><span class="line"><span class="string">              - uat</span></span><br><span class="line"><span class="string">              - uat2</span></span><br><span class="line"><span class="string">              - uat3</span></span><br><span class="line"><span class="string">              - aux</span></span><br><span class="line"><span class="string">              - preprod</span></span><br><span class="line"><span class="string">              - production</span></span><br><span class="line"><span class="string">              - staging</span></span><br><span class="line"><span class="string">              - qa</span></span><br><span class="line"><span class="string">      &quot;RemovePodsViolatingInterPodAntiAffinity&quot;:</span></span><br><span class="line"><span class="string">        enabled: true</span></span><br><span class="line"><span class="string">      &quot;RemovePodsHavingTooManyRestarts&quot;:</span></span><br><span class="line"><span class="string">        enabled: true</span></span><br><span class="line"><span class="string">        params:</span></span><br><span class="line"><span class="string">          podsHavingTooManyRestarts:</span></span><br><span class="line"><span class="string">            podRestartThreshold: 100</span></span><br><span class="line"><span class="string">            includingInitContainers: true</span></span><br><span class="line"><span class="string">      &quot;LowNodeUtilization&quot;:</span></span><br><span class="line"><span class="string">        enabled: true</span></span><br><span class="line"><span class="string">        params:</span></span><br><span class="line"><span class="string">          nodeResourceUtilizationThresholds:</span></span><br><span class="line"><span class="string">            thresholds:</span></span><br><span class="line"><span class="string">              &quot;cpu&quot; : 20</span></span><br><span class="line"><span class="string">              &quot;memory&quot;: 20</span></span><br><span class="line"><span class="string">              &quot;pods&quot;: 20</span></span><br><span class="line"><span class="string">            targetThresholds:</span></span><br><span class="line"><span class="string">              &quot;cpu&quot; : 70</span></span><br><span class="line"><span class="string">              &quot;memory&quot;: 70</span></span><br><span class="line"><span class="string">              &quot;pods&quot;: 40</span></span><br><span class="line"><span class="string">      &quot;PodLifeTime&quot;:</span></span><br><span class="line"><span class="string">        enabled: false</span></span><br><span class="line"><span class="string">        params:</span></span><br><span class="line"><span class="string">          podLifeTime:</span></span><br><span class="line"><span class="string">            maxPodLifeTimeSeconds: 86400</span></span><br><span class="line"><span class="string">            podStatusPhases:</span></span><br><span class="line"><span class="string">            - &quot;Pending&quot;</span></span><br><span class="line"><span class="string"></span><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">descheduler-cronjob</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;*/2 * * * *&quot;</span></span><br><span class="line">  <span class="attr">concurrencyPolicy:</span> <span class="string">&quot;Forbid&quot;</span></span><br><span class="line">  <span class="attr">successfulJobsHistoryLimit:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">metadata:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">descheduler-pod</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">descheduler</span></span><br><span class="line">              <span class="attr">image:</span> <span class="string">k8s.gcr.io/descheduler/descheduler:v0.19.0</span></span><br><span class="line">              <span class="attr">volumeMounts:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/policy-dir</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">policy-volume</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;/bin/descheduler&quot;</span></span><br><span class="line">              <span class="attr">args:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;--policy-config-file&quot;</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;/policy-dir/policy.yaml&quot;</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;--v&quot;</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">&quot;Never&quot;</span></span><br><span class="line">          <span class="attr">serviceAccountName:</span> <span class="string">descheduler-sa</span></span><br><span class="line">          <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">policy-volume</span></span><br><span class="line">              <span class="attr">configMap:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">descheduler-policy-configmap</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">descheduler-cluster-role</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;namespaces&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods/eviction&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;scheduling.k8s.io&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;priorityclasses&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">descheduler-sa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">descheduler-cluster-role-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">descheduler-cluster-role</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">descheduler-sa</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure><h3 id="结果"><a class="markdownIt-Anchor" href="#结果"></a> 结果</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">➜  descheduler git:(master) k get cronjob  -A</span><br><span class="line">NAMESPACE     NAME                  SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE</span><br><span class="line">kube-system   descheduler-cronjob   */2 * * * *   True      0        3d2h            8d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜  descheduler git:(master) k get pod -A | grep desc</span><br><span class="line">kube-system   descheduler-cronjob-1606710120-np5xc               0/1     Completed   0          3d2h</span><br><span class="line"></span><br><span class="line">➜  descheduler git:(master) k logs -f descheduler-cronjob-1606710120-np5xc -n kube-system</span><br><span class="line">I1130 04:22:07.533753       1 node.go:45] node lister returned empty list, now fetch directly</span><br><span class="line">I1130 04:22:07.541476       1 toomanyrestarts.go:73] Processing node: cn-hongkong.10.0.3.20</span><br><span class="line">I1130 04:22:07.565399       1 toomanyrestarts.go:73] Processing node: cn-hongkong.10.0.3.21</span><br><span class="line">I1130 04:22:07.577738       1 duplicates.go:73] Processing node: &quot;cn-hongkong.10.0.3.20&quot;</span><br><span class="line">I1130 04:22:07.593279       1 duplicates.go:73] Processing node: &quot;cn-hongkong.10.0.3.21&quot;</span><br><span class="line">I1130 04:22:07.632923       1 lownodeutilization.go:203] Node &quot;cn-hongkong.10.0.3.20&quot; is appropriately utilized with usage: api.ResourceThresholds&#123;&quot;cpu&quot;:32.5, &quot;memory&quot;:29.3980074559352, &quot;pods&quot;:17.1875&#125;</span><br><span class="line">I1130 04:22:07.632997       1 lownodeutilization.go:203] Node &quot;cn-hongkong.10.0.3.21&quot; is appropriately utilized with usage: api.ResourceThresholds&#123;&quot;cpu&quot;:30, &quot;memory&quot;:23.303233323623655, &quot;pods&quot;:15.625&#125;</span><br><span class="line">I1130 04:22:07.633016       1 lownodeutilization.go:101] Criteria for a node under utilization: CPU: 20, Mem: 20, Pods: 20</span><br><span class="line">I1130 04:22:07.633028       1 lownodeutilization.go:105] No node is underutilized, nothing to do here, you might tune your thresholds further</span><br><span class="line">I1130 04:22:07.633042       1 pod_antiaffinity.go:72] Processing node: &quot;cn-hongkong.10.0.3.20&quot;</span><br><span class="line">I1130 04:22:07.647199       1 pod_antiaffinity.go:72] Processing node: &quot;cn-hongkong.10.0.3.21&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;原理&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#原理&quot;&gt;&lt;/a&gt; 原理&lt;/h3&gt;
&lt;p&gt;kube-scheduler通过各种算法计算出最佳节点去运行Pod,当出现新的 Pod 进行调度时，调度程序会根据其当时对 Kubernetes
      
    
    </summary>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/categories/k8s/"/>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/tags/k8s/"/>
    
      <category term="descheduler" scheme="https://www.xiemx.com/tags/descheduler/"/>
    
  </entry>
  
  <entry>
    <title>nginx-ingress下使用ldap 实现ingress auth认证</title>
    <link href="https://www.xiemx.com//2020/11/21/nginx-ingress-ldap/"/>
    <id>https://www.xiemx.com//2020/11/21/nginx-ingress-ldap/</id>
    <published>2020-11-21T09:05:04.000Z</published>
    <updated>2023-06-09T07:36:51.524Z</updated>
    
    <content type="html"><![CDATA[<h3 id="原理"><a class="markdownIt-Anchor" href="#原理"></a> 原理</h3><p>使用nginx subrequest在请求直线通过 ingress annotation注入一条规则去调用auth接口完成ldap认证。参考文档：</p><ul><li><a href="http://nginx.org/en/docs/http/ngx_http_auth_request_module.html">http://nginx.org/en/docs/http/ngx_http_auth_request_module.html</a></li><li><a href="https://www.nginx.com/blog/nginx-plus-authenticate-users">https://www.nginx.com/blog/nginx-plus-authenticate-users</a></li><li><a href="https://docs.foxpass.com/docs/ldap-overview-debugging">https://docs.foxpass.com/docs/ldap-overview-debugging</a></li><li><a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#external-authentication">https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#external-authentication</a></li></ul><h3 id="创建ldap认证服务"><a class="markdownIt-Anchor" href="#创建ldap认证服务"></a> 创建ldap认证服务</h3><h2 id="yaml"><a class="markdownIt-Anchor" href="#yaml"></a> ```yaml</h2><p>apiVersion: v1<br />kind: ConfigMap<br />metadata:<br />name: nginx-ldap-auth-config<br />data:<br />foxpass.conf: |<br /># define ldap server<br />ldap_server foxpass {<br />url “ldaps://ldap.foxpass.com:636/dc=xiemx,dc=com?uid?sub?(objectClass=*)”;<br />binddn “{dn信息}”; # cn=test,dc=xiemx,dc=com<br />binddn_passwd “xxxxxx”;<br />group_attribute groups;<br />group_attribute_is_dn on;<br />require valid_user;<br />}</p><pre><code>server &#123;  listen 5555;  location / &#123;    auth_ldap &quot;foxpass&quot;;    auth_ldap_servers foxpass;    try_files index.html,index.htm @auth;  &#125;  location @auth &#123;    return 200 &quot;ldap auth&quot;;  &#125;&#125;</code></pre><hr /><h2 id="apiversion-v1kind-serviceaccountmetadataname-nginx-ldap-auth"><a class="markdownIt-Anchor" href="#apiversion-v1kind-serviceaccountmetadataname-nginx-ldap-auth"></a> apiVersion: v1<br />kind: ServiceAccount<br />metadata:<br />name: nginx-ldap-auth</h2><p>apiVersion: <a href="http://rbac.authorization.k8s.io/v1beta1">rbac.authorization.k8s.io/v1beta1</a><br />kind: Role<br />metadata:<br />name: nginx-ldap-auth<br />rules:</p><ul><li>apiGroups:<ul><li>“”<br />resources:</li><li>configmaps<br />resourceNames:</li><li>“nginx-ladp-auth-config”<br />verbs:</li><li>get</li></ul></li></ul><hr /><p>apiVersion: <a href="http://rbac.authorization.k8s.io/v1beta1">rbac.authorization.k8s.io/v1beta1</a><br />kind: RoleBinding<br />metadata:<br />name: nginx-ldap-auth<br />roleRef:<br />apiGroup: <a href="http://rbac.authorization.k8s.io">rbac.authorization.k8s.io</a><br />kind: Role<br />name: nginx-ldap-auth<br />subjects:</p><ul><li>kind: ServiceAccount<br />name: nginx-ldap-auth</li></ul><hr /><p>kind: Service<br />apiVersion: v1<br />metadata:<br />name: nginx-ldap-auth<br />spec:<br />type: ClusterIP<br />ports:</p><ul><li>name: nginx-ldap-auth<br />port: 5555<br />protocol: TCP<br />targetPort: 5555<br />selector:<br />app: nginx-ldap-auth</li></ul><hr /><h2 id="kind-deploymentapiversion-appsv1metadataname-nginx-ldap-authlabelsapp-nginx-ldap-authspecreplicas-1selectormatchlabelsapp-nginx-ldap-authtemplatemetadatalabelsapp-nginx-ldap-authspecserviceaccountname-nginx-ldap-authcontainers-image-weseeknginx-auth-ldap11511-alpinename-nginx-ldap-authports-name-httpcontainerport-5555resourceslimitsmemory-200mirequestscpu-100mmemory-200mivolumemounts-name-configmountpath-etcnginxconfdvolumes-name-configconfigmapname-nginx-ldap-auth-config"><a class="markdownIt-Anchor" href="#kind-deploymentapiversion-appsv1metadataname-nginx-ldap-authlabelsapp-nginx-ldap-authspecreplicas-1selectormatchlabelsapp-nginx-ldap-authtemplatemetadatalabelsapp-nginx-ldap-authspecserviceaccountname-nginx-ldap-authcontainers-image-weseeknginx-auth-ldap11511-alpinename-nginx-ldap-authports-name-httpcontainerport-5555resourceslimitsmemory-200mirequestscpu-100mmemory-200mivolumemounts-name-configmountpath-etcnginxconfdvolumes-name-configconfigmapname-nginx-ldap-auth-config"></a> kind: Deployment<br />apiVersion: apps/v1<br />metadata:<br />name: nginx-ldap-auth<br />labels:<br />app: nginx-ldap-auth<br />spec:<br />replicas: 1<br />selector:<br />matchLabels:<br />app: “nginx-ldap-auth”<br />template:<br />metadata:<br />labels:<br />app: nginx-ldap-auth<br />spec:<br />serviceAccountName: nginx-ldap-auth<br />containers:<br />- image: weseek/nginx-auth-ldap:1.15.11-alpine<br />name: nginx-ldap-auth<br />ports:<br />- name: http<br />containerPort: 5555<br />resources:<br />limits:<br />memory: 200Mi<br />requests:<br />cpu: 100m<br />memory: 200Mi<br />volumeMounts:<br />- name: config<br />mountPath: /etc/nginx/conf.d<br />volumes:<br />- name: config<br />configMap:<br />name: nginx-ldap-auth-config</h2><p>apiVersion: extensions/v1beta1<br />kind: Ingress<br />metadata:<br />annotations:<br /><a href="http://kubernetes.io/ingress.class:">kubernetes.io/ingress.class:</a> nginx<br />labels:<br />app: nginx-ldap-auth<br />name: nginx-ldap-auth<br />spec:<br />rules:</p><ul><li>host: <a href="http://foxpass.i.xiemx.com">foxpass.i.xiemx.com</a><br />http:<br />paths:<ul><li>backend:<br />serviceName: nginx-ldap-auth<br />servicePort: 5555<br />path: /</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### ingress 开启auth认证</span></span><br><span class="line"></span><br><span class="line"><span class="string">```yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">nginx.ingress.kubernetes.io/auth-url:</span> <span class="string">https://foxpass.i.xiemx.com</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kibana.i.xiemx.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">kibana</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 测试</span></span><br><span class="line"><span class="string">➜</span>  <span class="string">kibana</span> <span class="string">git:(master)</span> <span class="string">curl</span> <span class="string">kibana.i.xiemx.com</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;&lt;title&gt;401</span> <span class="string">Authorization</span> <span class="string">Required&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;center&gt;&lt;h1&gt;401</span> <span class="string">Authorization</span> <span class="string">Required&lt;/h1&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string">&lt;hr&gt;&lt;center&gt;nginx/1.15.9&lt;/center&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">➜</span>  <span class="string">kibana</span> <span class="string">git:(master)</span> <span class="string">curl</span> <span class="string">kibana.i.xiemx.com</span> <span class="string">--user</span> <span class="string">mingxu.xie</span></span><br><span class="line"><span class="string">Enter</span> <span class="string">host</span> <span class="string">password</span> <span class="string">for</span> <span class="string">user</span> <span class="attr">&#x27;mingxu.xie&#x27;:</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;原理&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#原理&quot;&gt;&lt;/a&gt; 原理&lt;/h3&gt;
&lt;p&gt;使用nginx subrequest在请求直线通过 ingress annotation注入一条规则去调用auth接口完成ldap认证。参考文档
      
    
    </summary>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/categories/k8s/"/>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/tags/k8s/"/>
    
      <category term="ingress" scheme="https://www.xiemx.com/tags/ingress/"/>
    
      <category term="nginx" scheme="https://www.xiemx.com/tags/nginx/"/>
    
      <category term="ldap" scheme="https://www.xiemx.com/tags/ldap/"/>
    
  </entry>
  
  <entry>
    <title>kong ingress</title>
    <link href="https://www.xiemx.com//2020/11/03/aws-alb-ingress/"/>
    <id>https://www.xiemx.com//2020/11/03/aws-alb-ingress/</id>
    <published>2020-11-03T02:52:00.000Z</published>
    <updated>2023-06-09T07:36:51.486Z</updated>
    
    <content type="html"><![CDATA[<h2 id="kong-ingress"><a class="markdownIt-Anchor" href="#kong-ingress"></a> Kong Ingress</h2><p>项目地址：<a href="https://github.com/Kong/kubernetes-ingress-controller">https://github.com/Kong/kubernetes-ingress-controller</a></p><p><img src="/images/kong-architecture.jpg" alt="kong-architecture" /></p><p>结论：</p><ul><li>kongIngress和kongPlugin 可以看成是对原始ingress进行增强的补丁（个人理解）</li><li>kong ingress 可以原则上无缝接管nginx ingress</li><li>kong ingress 可以实现规则灵活挂接，可允许在<code>SVC</code>、<code>INGRESS</code> 上接入规则，可以基于ingress实现host 级别 global规则，也可基于path分别对于不同的svc进行管理</li></ul><hr /><h4 id="install-controller"><a class="markdownIt-Anchor" href="#install-controller"></a> install controller</h4><details><summary>ingress-controller.yaml</summary><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kongclusterplugins.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">additionalPrinterColumns:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.plugin</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Name</span> <span class="string">of</span> <span class="string">the</span> <span class="string">plugin</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Plugin-Type</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.metadata.creationTimestamp</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">date</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.disabled</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Indicates</span> <span class="string">if</span> <span class="string">the</span> <span class="string">plugin</span> <span class="string">is</span> <span class="string">disabled</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Disabled</span></span><br><span class="line">    <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.config</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Configuration</span> <span class="string">of</span> <span class="string">the</span> <span class="string">plugin</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Config</span></span><br><span class="line">    <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">KongClusterPlugin</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">kongclusterplugins</span></span><br><span class="line">    <span class="attr">shortNames:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kcp</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">validation:</span></span><br><span class="line">    <span class="attr">openAPIV3Schema:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">configFrom:</span></span><br><span class="line">          <span class="attr">properties:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">key:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">name:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">namespace:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">name</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">namespace</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">key</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">disabled:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">        <span class="attr">plugin:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">protocols:</span></span><br><span class="line">          <span class="attr">items:</span></span><br><span class="line">            <span class="attr">enum:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">http</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">grpc</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">grpcs</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">tcp</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">tls</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">        <span class="attr">run_on:</span></span><br><span class="line">          <span class="attr">enum:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">first</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">second</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">all</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">plugin</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kongconsumers.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">additionalPrinterColumns:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.username</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Username</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kong</span> <span class="string">Consumer</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Username</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.metadata.creationTimestamp</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">date</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">KongConsumer</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">kongconsumers</span></span><br><span class="line">    <span class="attr">shortNames:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kc</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">validation:</span></span><br><span class="line">    <span class="attr">openAPIV3Schema:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">credentials:</span></span><br><span class="line">          <span class="attr">items:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">        <span class="attr">custom_id:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">username:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kongcredentials.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">additionalPrinterColumns:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.type</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Type</span> <span class="string">of</span> <span class="string">credential</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Credential-type</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.metadata.creationTimestamp</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">date</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.consumerRef</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Owner</span> <span class="string">of</span> <span class="string">the</span> <span class="string">credential</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Consumer-Ref</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">KongCredential</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">kongcredentials</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">validation:</span></span><br><span class="line">    <span class="attr">openAPIV3Schema:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">consumerRef:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">type:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">consumerRef</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">type</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kongingresses.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">KongIngress</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">kongingresses</span></span><br><span class="line">    <span class="attr">shortNames:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ki</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">validation:</span></span><br><span class="line">    <span class="attr">openAPIV3Schema:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">proxy:</span></span><br><span class="line">          <span class="attr">properties:</span></span><br><span class="line">            <span class="attr">connect_timeout:</span></span><br><span class="line">              <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">path:</span></span><br><span class="line">              <span class="attr">pattern:</span> <span class="string">^/.*$</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">protocol:</span></span><br><span class="line">              <span class="attr">enum:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">http</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">grpc</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">grpcs</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">tcp</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">tls</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">read_timeout:</span></span><br><span class="line">              <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">retries:</span></span><br><span class="line">              <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">write_timeout:</span></span><br><span class="line">              <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">route:</span></span><br><span class="line">          <span class="attr">properties:</span></span><br><span class="line">            <span class="attr">headers:</span></span><br><span class="line">              <span class="attr">additionalProperties:</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">            <span class="attr">https_redirect_status_code:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">methods:</span></span><br><span class="line">              <span class="attr">items:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">path_handling:</span></span><br><span class="line">              <span class="attr">enum:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">v0</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">preserve_host:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">            <span class="attr">protocols:</span></span><br><span class="line">              <span class="attr">items:</span></span><br><span class="line">                <span class="attr">enum:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">http</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">grpc</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">grpcs</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">tcp</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">tls</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">regex_priority:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">strip_path:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">        <span class="attr">upstream:</span></span><br><span class="line">          <span class="attr">properties:</span></span><br><span class="line">            <span class="attr">algorithm:</span></span><br><span class="line">              <span class="attr">enum:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">round-robin</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">consistent-hashing</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">least-connections</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">hash_fallback:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">hash_fallback_header:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">hash_on:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">hash_on_cookie:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">hash_on_cookie_path:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">hash_on_header:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">healthchecks:</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">active:</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">concurrency:</span></span><br><span class="line">                      <span class="attr">minimum:</span> <span class="number">1</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">healthy:</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">http_statuses:</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">interval:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">successes:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">http_path:</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^/.*$</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">timeout:</span></span><br><span class="line">                      <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">unhealthy:</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">http_failures:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">http_statuses:</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">interval:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">tcp_failures:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">timeout:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">passive:</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">healthy:</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">http_statuses:</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">interval:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">successes:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">unhealthy:</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">http_failures:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">http_statuses:</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">interval:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">tcp_failures:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">timeout:</span></span><br><span class="line">                          <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">threshold:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">            <span class="attr">host_header:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">slots:</span></span><br><span class="line">              <span class="attr">minimum:</span> <span class="number">10</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kongplugins.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">additionalPrinterColumns:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.plugin</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Name</span> <span class="string">of</span> <span class="string">the</span> <span class="string">plugin</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Plugin-Type</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.metadata.creationTimestamp</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">date</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.disabled</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Indicates</span> <span class="string">if</span> <span class="string">the</span> <span class="string">plugin</span> <span class="string">is</span> <span class="string">disabled</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Disabled</span></span><br><span class="line">    <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.config</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Configuration</span> <span class="string">of</span> <span class="string">the</span> <span class="string">plugin</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Config</span></span><br><span class="line">    <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">KongPlugin</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">kongplugins</span></span><br><span class="line">    <span class="attr">shortNames:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kp</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">validation:</span></span><br><span class="line">    <span class="attr">openAPIV3Schema:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">configFrom:</span></span><br><span class="line">          <span class="attr">properties:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">key:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">name:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">name</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">key</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">disabled:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">        <span class="attr">plugin:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">protocols:</span></span><br><span class="line">          <span class="attr">items:</span></span><br><span class="line">            <span class="attr">enum:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">http</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">grpc</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">grpcs</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">tcp</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">tls</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">        <span class="attr">run_on:</span></span><br><span class="line">          <span class="attr">enum:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">first</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">second</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">all</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">plugin</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tcpingresses.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">additionalPrinterColumns:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.status.loadBalancer.ingress[*].ip</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">load</span> <span class="string">balancer</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Address</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">JSONPath:</span> <span class="string">.metadata.creationTimestamp</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Age</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">date</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">TCPIngress</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">tcpingresses</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">subresources:</span></span><br><span class="line">    <span class="attr">status:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">validation:</span></span><br><span class="line">    <span class="attr">openAPIV3Schema:</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">apiVersion:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">kind:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">metadata:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">properties:</span></span><br><span class="line">            <span class="attr">rules:</span></span><br><span class="line">              <span class="attr">items:</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">backend:</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">serviceName:</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">servicePort:</span></span><br><span class="line">                        <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">host:</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">port:</span></span><br><span class="line">                    <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">tls:</span></span><br><span class="line">              <span class="attr">items:</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">hosts:</span></span><br><span class="line">                    <span class="attr">items:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                  <span class="attr">secretName:</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">status:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1beta1</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong-serviceaccount</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong-ingress-clusterrole</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.k8s.io</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.internal.knative.dev</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">events</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.k8s.io</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.internal.knative.dev</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ingresses/status</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tcpingresses/status</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kongplugins</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kongclusterplugins</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kongcredentials</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kongconsumers</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kongingresses</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tcpingresses</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong-ingress-clusterrole-nisa-binding</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong-ingress-clusterrole</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong-serviceaccount</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment">#    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp</span></span><br><span class="line">    <span class="comment">#    service.beta.kubernetes.io/aws-load-balancer-type: nlb</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong-proxy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">proxy</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8000</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">proxy-ssl</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8443</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ingress-kong</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kong-validation-webhook</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">webhook</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ingress-kong</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ingress-kong</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-kong</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">ingress-kong</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">kuma.io/gateway:</span> <span class="string">enabled</span></span><br><span class="line">        <span class="attr">prometheus.io/port:</span> <span class="string">&quot;8100&quot;</span></span><br><span class="line">        <span class="attr">prometheus.io/scrape:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">        <span class="attr">traffic.sidecar.istio.io/includeInboundPorts:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">ingress-kong</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_PROXY_LISTEN</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8000,</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8443</span> <span class="string">ssl</span> <span class="string">http2</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_ADMIN_LISTEN</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8444</span> <span class="string">ssl</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_STATUS_LISTEN</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8100</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_DATABASE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_NGINX_WORKER_PROCESSES</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_ADMIN_ACCESS_LOG</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">/dev/stdout</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_ADMIN_ERROR_LOG</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">/dev/stderr</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KONG_PROXY_ERROR_LOG</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">/dev/stderr</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">kong:2.0</span></span><br><span class="line">        <span class="attr">lifecycle:</span></span><br><span class="line">          <span class="attr">preStop:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">kong</span> <span class="string">quit</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/status</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8100</span></span><br><span class="line">            <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">proxy</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8000</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">proxy</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8443</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">proxy-ssl</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8100</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">metrics</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/status</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8100</span></span><br><span class="line">            <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONTROLLER_KONG_ADMIN_URL</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">https://127.0.0.1:8444</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONTROLLER_KONG_ADMIN_TLS_SKIP_VERIFY</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONTROLLER_PUBLISH_SERVICE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">kong/kong-proxy</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">kong-docker-kubernetes-ingress-controller.bintray.io/kong-ingress-controller:0.9.1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">            <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">ingress-controller</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">webhook</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">            <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">kong-serviceaccount</span></span><br></pre></td></tr></table></figure></details><h4 id="部署测试服务"><a class="markdownIt-Anchor" href="#部署测试服务"></a> 部署测试服务</h4><details><summary>echo.yaml</summary><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">echo</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">echo-v1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">high</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">low</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">echo</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">echo</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">echo-v2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">high</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">low</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">echo</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">echo</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">echo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">echo</span></span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">echo</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">gcr.io/kubernetes-e2e-test-images/echoserver:2.2</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">echo</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODE_NAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_IP</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/v1</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">echo-v1</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/v2</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">echo-v2</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></details><details><summary>KongPlugins.yaml</summary><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">configuration.konghq.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KongPlugin</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">auth</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="attr">plugin:</span> <span class="string">key-auth</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">configuration.konghq.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KongPlugin</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">global:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">global-rate-limit</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">limit_by:</span> <span class="string">consumer</span></span><br><span class="line">  <span class="attr">minute:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">policy:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">plugin:</span> <span class="string">rate-limiting</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">configuration.konghq.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KongPlugin</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rate-limit</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">limit_by:</span> <span class="string">consumer</span></span><br><span class="line">  <span class="attr">minute:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">policy:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">plugin:</span> <span class="string">rate-limiting</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">configuration.konghq.com/v1</span></span><br><span class="line"><span class="attr">plugin:</span> <span class="string">correlation-id</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">header_name:</span> <span class="string">X-Request-ID</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KongPlugin</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">request-id</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">configuration.konghq.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KongPlugin</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">response-header</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kong</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">add:</span></span><br><span class="line">    <span class="attr">headers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;x-cust-resp-header: xiemx&#x27;</span></span><br><span class="line"><span class="attr">plugin:</span> <span class="string">response-transformer</span></span><br></pre></td></tr></table></figure></details><details><summary>KongIngress.yaml</summary><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">configuration.konghq.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KongIngress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">custom-ingress</span></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line">  <span class="attr">methods:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GET</span></span><br><span class="line">    <span class="comment">#strip_path: true</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">configuration.konghq.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">KongIngress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">custom-svc</span></span><br><span class="line"><span class="attr">upstream:</span></span><br><span class="line">  <span class="attr">hash_on:</span> <span class="string">ip</span></span><br><span class="line"><span class="attr">proxy:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/foo/</span></span><br></pre></td></tr></table></figure></details><h4 id="测试"><a class="markdownIt-Anchor" href="#测试"></a> 测试</h4><p>本测试只使用少数几个plugin测试kong的ingress、svc规则生效，具体plugin可以另行测试，已附上对应具体yaml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">➜  kong git:(master) ✗ kga</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/echo-85fb7989cc-pmjq7          1/1     Running   0          2d14h</span><br><span class="line">pod/ingress-kong-d7b5d68f4-8v9tk   2/2     Running   0          2d14h</span><br><span class="line"></span><br><span class="line">NAME                              TYPE           CLUSTER-IP       EXTERNAL-IP                                                                    PORT(S)                      AGE</span><br><span class="line">service/echo-v1                   ClusterIP      172.20.76.165    &lt;none&gt;                                                                         8080/TCP,80/TCP              2d21h</span><br><span class="line">service/echo-v2                   ClusterIP      172.20.198.164   &lt;none&gt;                                                                         8080/TCP,80/TCP              2d21h</span><br><span class="line">service/kong-proxy                LoadBalancer   172.20.113.185   a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com   80:31957/TCP,443:30218/TCP   2d21h</span><br><span class="line">service/kong-validation-webhook   ClusterIP      172.20.51.128    &lt;none&gt;                                                                         443/TCP                      2d21h</span><br><span class="line"></span><br><span class="line">NAME                           READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/echo           1/1     1            1           2d21h</span><br><span class="line">deployment.apps/ingress-kong   1/1     1            1           2d21h</span><br><span class="line"></span><br><span class="line">NAME                                     DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/echo-85fb7989cc          1         1         1       2d21h</span><br><span class="line">replicaset.apps/ingress-kong-d7b5d68f4   1         1         1       2d21h</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ k get kongingress</span><br><span class="line">NAME             AGE</span><br><span class="line">custom-ingress   2d21h</span><br><span class="line">custom-svc       2d21h</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ k get kongPlugin</span><br><span class="line">NAME              PLUGIN-TYPE            AGE</span><br><span class="line">rate-limit        rate-limiting          2d21h</span><br><span class="line">request-id        correlation-id         2d21h</span><br><span class="line">response-header   response-transformer   2d21h</span><br></pre></td></tr></table></figure><ul><li>测试ingress 规则注入</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 无注入访问/v1 和 /v2</span></span></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v2 -X POST -I</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Mon, 07 Dec 2020 03:53:09 GMT</span><br><span class="line">Server: echoserver</span><br><span class="line">X-Kong-Upstream-Latency: 0</span><br><span class="line">X-Kong-Proxy-Latency: 0</span><br><span class="line">Via: kong/2.0.5</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v1 -X POST -I</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Mon, 07 Dec 2020 03:53:16 GMT</span><br><span class="line">Server: echoserver</span><br><span class="line">X-Kong-Upstream-Latency: 0</span><br><span class="line">X-Kong-Proxy-Latency: 0</span><br><span class="line">Via: kong/2.0.5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 注入ingress，限制请求方法为GET</span></span></span><br><span class="line">➜  kong git:(master) ✗ cat kongIngress/ingress.yaml</span><br><span class="line">apiVersion: configuration.konghq.com/v1</span><br><span class="line">kind: KongIngress</span><br><span class="line">metadata:</span><br><span class="line">  name: custom-ingress</span><br><span class="line">route:</span><br><span class="line">  methods:</span><br><span class="line">  - GET</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ k describe ingress demo</span><br><span class="line">Name:             demo</span><br><span class="line">Namespace:        kong</span><br><span class="line">Address:          a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com</span><br><span class="line">Default backend:  default-http-backend:80 (&lt;none&gt;)</span><br><span class="line">Rules:</span><br><span class="line">  Host  Path  Backends</span><br><span class="line">  ----  ----  --------</span><br><span class="line">  *</span><br><span class="line">        /v1   echo-v1:80 (10.200.1.88:8080)</span><br><span class="line">        /v2   echo-v2:80 (10.200.1.88:8080)</span><br><span class="line">Annotations:</span><br><span class="line">  konghq.com/override:                               custom-ingress</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v1 -X POST -I</span><br><span class="line">HTTP/1.1 404 Not Found</span><br><span class="line">Date: Mon, 07 Dec 2020 03:56:31 GMT</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 48</span><br><span class="line">X-Kong-Response-Latency: 1</span><br><span class="line">Server: kong/2.0.5</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v2 -X POST -I</span><br><span class="line">HTTP/1.1 404 Not Found</span><br><span class="line">Date: Mon, 07 Dec 2020 03:56:37 GMT</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 48</span><br><span class="line">X-Kong-Response-Latency: 0</span><br><span class="line">Server: kong/2.0.5</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v2 -X GET -I</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Mon, 07 Dec 2020 03:56:43 GMT</span><br><span class="line">Server: echoserver</span><br><span class="line">X-Kong-Upstream-Latency: 1</span><br><span class="line">X-Kong-Proxy-Latency: 0</span><br><span class="line">Via: kong/2.0.5</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v1 -X GET -I</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Mon, 07 Dec 2020 03:56:48 GMT</span><br><span class="line">Server: echoserver</span><br><span class="line">X-Kong-Upstream-Latency: 0</span><br><span class="line">X-Kong-Proxy-Latency: 0</span><br><span class="line">Via: kong/2.0.5</span><br></pre></td></tr></table></figure><ul><li>测试svc 规则注入</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">➜  kong git:(master) ✗ cat kongIngress/ingress.yaml</span><br><span class="line">apiVersion: configuration.konghq.com/v1</span><br><span class="line">kind: KongIngress</span><br><span class="line">metadata:</span><br><span class="line">  name: custom-svc</span><br><span class="line">proxy:</span><br><span class="line">  path: /foo/</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ k describe svc echo-v1 echo-v2</span><br><span class="line">Name:              echo-v1</span><br><span class="line">Namespace:         kong</span><br><span class="line">Labels:            app=echo</span><br><span class="line">Annotations:       konghq.com/override: custom-svc</span><br><span class="line">                   kubectl.kubernetes.io/last-applied-configuration:</span><br><span class="line">                     &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&quot;configuration.konghq.com&quot;:&quot;custom-svc&quot;&#125;,&quot;labels&quot;:&#123;&quot;app&quot;:&quot;echo&quot;&#125;,&quot;name&quot;:&quot;ec...</span><br><span class="line">Selector:          app=echo</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                172.20.76.165</span><br><span class="line">Port:              high  8080/TCP</span><br><span class="line">TargetPort:        8080/TCP</span><br><span class="line">Endpoints:         10.200.1.88:8080</span><br><span class="line">Port:              low  80/TCP</span><br><span class="line">TargetPort:        8080/TCP</span><br><span class="line">Endpoints:         10.200.1.88:8080</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name:              echo-v2</span><br><span class="line">Namespace:         kong</span><br><span class="line">Labels:            app=echo</span><br><span class="line">Annotations:       kubectl.kubernetes.io/last-applied-configuration:</span><br><span class="line">                     &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;app&quot;:&quot;echo&quot;&#125;,&quot;name&quot;:&quot;echo-v2&quot;,&quot;namespace&quot;:&quot;kong&quot;&#125;,&quot;spec&quot;:&#123;&quot;por...</span><br><span class="line">Selector:          app=echo</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                172.20.198.164</span><br><span class="line">Port:              high  8080/TCP</span><br><span class="line">TargetPort:        8080/TCP</span><br><span class="line">Endpoints:         10.200.1.88:8080</span><br><span class="line">Port:              low  80/TCP</span><br><span class="line">TargetPort:        8080/TCP</span><br><span class="line">Endpoints:         10.200.1.88:8080</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 测试</span></span></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v1 -X GET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Hostname: echo-85fb7989cc-pmjq7</span><br><span class="line"></span><br><span class="line">Pod Information:</span><br><span class="line">node name:ip-10-200-1-155.ap-northeast-1.compute.internal</span><br><span class="line">pod name:echo-85fb7989cc-pmjq7</span><br><span class="line">pod namespace:kong</span><br><span class="line">pod IP:10.200.1.88</span><br><span class="line"></span><br><span class="line">Server values:</span><br><span class="line">server_version=nginx: 1.12.2 - lua: 10010</span><br><span class="line"></span><br><span class="line">Request Information:</span><br><span class="line">client_address=10.200.1.189</span><br><span class="line">method=GET</span><br><span class="line">real path=/foo/v1</span><br><span class="line">query=</span><br><span class="line">request_version=1.1</span><br><span class="line">request_scheme=http</span><br><span class="line">request_uri=http://a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com:8080/foo/v1</span><br><span class="line"></span><br><span class="line">Request Headers:</span><br><span class="line">accept=*/*</span><br><span class="line">connection=keep-alive</span><br><span class="line">host=a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com</span><br><span class="line">user-agent=curl/7.54.0</span><br><span class="line">x-forwarded-for=10.200.2.91</span><br><span class="line">x-forwarded-host=a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com</span><br><span class="line">x-forwarded-port=8000</span><br><span class="line">x-forwarded-proto=http</span><br><span class="line">x-real-ip=10.200.2.91</span><br><span class="line"></span><br><span class="line">Request Body:</span><br><span class="line">-no body in request-</span><br><span class="line"></span><br><span class="line">➜  kong git:(master) ✗ curl a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com/v2 -X GET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Hostname: echo-85fb7989cc-pmjq7</span><br><span class="line"></span><br><span class="line">Pod Information:</span><br><span class="line">node name:ip-10-200-1-155.ap-northeast-1.compute.internal</span><br><span class="line">pod name:echo-85fb7989cc-pmjq7</span><br><span class="line">pod namespace:kong</span><br><span class="line">pod IP:10.200.1.88</span><br><span class="line"></span><br><span class="line">Server values:</span><br><span class="line">server_version=nginx: 1.12.2 - lua: 10010</span><br><span class="line"></span><br><span class="line">Request Information:</span><br><span class="line">client_address=10.200.1.189</span><br><span class="line">method=GET</span><br><span class="line">real path=/v2</span><br><span class="line">query=</span><br><span class="line">request_version=1.1</span><br><span class="line">request_scheme=http</span><br><span class="line">request_uri=http://a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com:8080/v2</span><br><span class="line"></span><br><span class="line">Request Headers:</span><br><span class="line">accept=*/*</span><br><span class="line">connection=keep-alive</span><br><span class="line">host=a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com</span><br><span class="line">user-agent=curl/7.54.0</span><br><span class="line">x-forwarded-for=10.200.1.234</span><br><span class="line">x-forwarded-host=a7a642206e35c414d8c7be4330144b8f-1688272697.ap-northeast-1.elb.amazonaws.com</span><br><span class="line">x-forwarded-port=8000</span><br><span class="line">x-forwarded-proto=http</span><br><span class="line">x-real-ip=10.200.1.234</span><br><span class="line"></span><br><span class="line">Request Body:</span><br><span class="line">-no body in request-</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;kong-ingress&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#kong-ingress&quot;&gt;&lt;/a&gt; Kong Ingress&lt;/h2&gt;
&lt;p&gt;项目地址：&lt;a href=&quot;https://github.com/Kong/kube
      
    
    </summary>
    
    
      <category term="kong" scheme="https://www.xiemx.com/categories/kong/"/>
    
      <category term="ingress" scheme="https://www.xiemx.com/categories/kong/ingress/"/>
    
      <category term="k8s" scheme="https://www.xiemx.com/categories/kong/ingress/k8s/"/>
    
    
      <category term="k8s" scheme="https://www.xiemx.com/tags/k8s/"/>
    
      <category term="kong" scheme="https://www.xiemx.com/tags/kong/"/>
    
      <category term="ingress" scheme="https://www.xiemx.com/tags/ingress/"/>
    
  </entry>
  
</feed>
